/*!
 * JavaScript Debug - v0.4 - 6/22/2010
 * http://benalman.com/projects/javascript-debug-console-log/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 * 
 * With lots of help from Paul Irish!
 * http://paulirish.com/
 */
// Script: JavaScript Debug: A simple wrapper for console.log
//
// *Version: 0.4, Last Updated: 6/22/2010*
// 
// Tested with Internet Explorer 6-8, Firefox 3-3.6, Safari 3-4, Chrome 3-5, Opera 9.6-10.5
// 
// Home       - http://benalman.com/projects/javascript-debug-console-log/
// GitHub     - http://github.com/cowboy/javascript-debug/
// Source     - http://github.com/cowboy/javascript-debug/raw/master/ba-debug.js
// (Minified) - http://github.com/cowboy/javascript-debug/raw/master/ba-debug.min.js (1.1kb)
// 
// About: License
// 
// Copyright (c) 2010 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
// 
// About: Support and Testing
// 
// Information about what browsers this code has been tested in.
// 
// Browsers Tested - Internet Explorer 6-8, Firefox 3-3.6, Safari 3-4, Chrome
// 3-5, Opera 9.6-10.5
// 
// About: Examples
// 
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
// 
// Examples - http://benalman.com/code/projects/javascript-debug/examples/debug/
// 
// About: Revision History
// 
// 0.4 - (6/22/2010) Added missing passthrough methods: exception,
//       groupCollapsed, table
// 0.3 - (6/8/2009) Initial release
// 
// Topic: Pass-through console methods
// 
// assert, clear, count, dir, dirxml, exception, group, groupCollapsed,
// groupEnd, profile, profileEnd, table, time, timeEnd, trace
// 
// These console methods are passed through (but only if both the console and
// the method exists), so use them without fear of reprisal. Note that these
// methods will not be passed through if the logging level is set to 0 via
// <debug.setLevel>.
window.debug=function(){function l(b){e&&(f||!c||!c.log)&&e.apply(a,b)}function m(a){return g>0?g>a:h.length+g<=a}var a=this,b=Array.prototype.slice,c=a.console,d={},e,f,g=9,h=["error","warn","info","debug","log"],i="assert clear count dir dirxml exception group groupCollapsed groupEnd profile profileEnd table time timeEnd trace".split(" "),j=i.length,k=[];while(--j>=0)(function(a){d[a]=function(){g!==0&&c&&c[a]&&c[a].apply(c,arguments)}})(i[j]);j=h.length;while(--j>=0)(function(e,f){d[f]=function(){var d=b.call(arguments),g=[f].concat(d);k.push(g),l(g);if(!c||!m(e))return;c.firebug?c[f].apply(a,d):c[f]?c[f](d):c.log(d)}})(j,h[j]);return d.setLevel=function(a){g=typeof a=="number"?a:9},d.setCallback=function(){var a=b.call(arguments),c=k.length,d=c;e=a.shift()||null,f=typeof a[0]=="boolean"?a.shift():!1,d-=typeof a[0]=="number"?a.shift():c;while(d<c)l(k[d++])},d}(),function(a,b){function t(){var a=d++;return a in h?t():a}function u(a){if(a===null||typeof a!="object")return a;var b=a.constructor();for(var c in a)b[c]=u(a[c]);return b}var c=function(a){return new c.fn.init(a)},d=1,e=50,f=1,g={},h={},i={},j=[],k,l,m,n=0,o=1e3/e,p=(new Date).getTime(),q=Array.prototype.slice,r=/\s*,\s*/,s=/\s+/;c.fn=c.prototype={init:function(a){if(typeof a!="string")return a||(a=0,a in h||(h[a]=this)),a in h?(this[0]=a,this.length=1,this.__c||(this.__c={}),h[a]||(h[a]=this),h[a]):(this.length=0,this);var b=0,c,d,e=!1,f=!1,i,j,k,l,m;if(a==="*"){for(c in h)this[+c]=h[c],b++;return this.length=b,this}a.indexOf(",")!==-1?(f=!0,i=r):a.indexOf(" ")!==-1&&(e=!0,i=s);for(c in h){if(!h.hasOwnProperty(c))continue;d=h[c];if(e||f){j=a.split(i),l=0,m=j.length,k=0;for(;l<m;l++)d.__c[j[l]]&&k++;if(e&&k===m||f&&k>0)this[b++]=+c}else d.__c[a]&&(this[b++]=+c)}b>0&&!e&&!f&&this.extend(g[a]);if(j&&e)for(l=0;l<m;l++)this.extend(g[j[l]]);return this.length=b,this},setName:function(a){var b=String(a);return this._entityName=b,this.trigger("NewEntityName",b),this},addComponent:function(a){var b=[],c=0,d,e=0,f,h;if(arguments.length>1){f=arguments.length;for(;e<f;e++)this.__c[arguments[e]]=!0,b.push(arguments[e])}else if(a.indexOf(",")!==-1){h=a.split(r),f=h.length;for(;e<f;e++)this.__c[h[e]]=!0,b.push(h[e])}else this.__c[a]=!0,b.push(a);d=b.length;for(;c<d;c++)comp=g[b[c]],this.extend(comp),comp&&"init"in comp&&comp.init.call(this);return this.trigger("NewComponent",d),this},toggleComponent:function(a){var b=0,c,d;if(arguments.length>1){c=arguments.length;for(;b<c;b++)this.has(arguments[b])?this.removeComponent(arguments[b]):this.addComponent(arguments[b])}else if(a.indexOf(",")!==-1){d=a.split(r),c=d.length;for(;b<c;b++)this.has(d[b])?this.removeComponent(d[b]):this.addComponent(d[b])}else this.has(a)?this.removeComponent(a):this.addComponent(a);return this},requires:function(a){var b=a.split(r),c=0,d=b.length,e;for(;c<d;++c)e=b[c],this.has(e)||this.addComponent(e);return this},removeComponent:function(a,b){if(b===!1){var c=g[a],d;for(d in c)delete this[d]}return delete this.__c[a],this.trigger("RemoveComponent",a),this},has:function(a){return!!this.__c[a]},attr:function(a,b){if(arguments.length===1)return typeof a=="string"?this[a]:(this.extend(a),this.trigger("Change",a),this);this[a]=b;var c={};return c[a]=b,this.trigger("Change",c),this},toArray:function(){return q.call(this,0)},timeout:function(a,b){return this.each(function(){var c=this;setTimeout(function(){a.call(c)},b)}),this},bind:function(a,b){if(this.length===1){i[a]||(i[a]={});var c=i[a];return c[this[0]]||(c[this[0]]=[]),c[this[0]].push(b),this}return this.each(function(){i[a]||(i[a]={});var c=i[a];c[this[0]]||(c[this[0]]=[]),c[this[0]].push(b)}),this},unbind:function(a,b){return this.each(function(){var c=i[a],d=0,e,f;if(!c||!c[this[0]])return this;e=c[this[0]].length;if(!b)return delete c[this[0]],this;for(;d<e;d++)f=c[this[0]],f[d]==b&&(f.splice(d,1),d--)}),this},trigger:function(a,b){if(this.length===1){if(i[a]&&i[a][this[0]]){var c=i[a][this[0]],d=0,e=c.length;for(;d<e;d++)c[d].call(this,b)}return this}return this.each(function(){if(i[a]&&i[a][this[0]]){var c=i[a][this[0]],d=0,e=c.length;for(;d<e;d++)c[d].call(this,b)}}),this},each:function(a){var b=0,c=this.length;for(;b<c;b++){if(!h[this[b]])continue;a.call(h[this[b]],b)}return this},clone:function(){var a=this.__c,b,d,e=c.e();for(b in a)e.addComponent(b);for(d in this)d!="0"&&d!="_global"&&d!="_changed"&&typeof this[d]!="function"&&typeof this[d]!="object"&&(e[d]=this[d]);return e},setter:function(a,b){return c.support.setter?this.__defineSetter__(a,b):c.support.defineProperty?Object.defineProperty(this,a,{set:b,configurable:!0}):m.push({prop:a,obj:this,fn:b}),this},destroy:function(){this.each(function(){this.trigger("Remove");for(var a in i)this.unbind(a);delete h[this[0]]})}},c.fn.init.prototype=c.fn,c.extend=c.fn.extend=function(a){var b=this,c;if(!a)return b;for(c in a){if(b===a[c])continue;b[c]=a[c]}return b},c.extend({init:function(a,b){return c.viewport.init(a,b),this.trigger("Load"),this.timer.init(),this},getVersion:function(){return"0.4.8"},stop:function(){return this.timer.stop(),c.stage.elem.parentNode.removeChild(c.stage.elem),this},pause:function(a){return(arguments.length==1?a:!this._paused)?(this.trigger("Pause"),this._paused=!0,c.timer.stop(),c.keydown={}):(this.trigger("Unpause"),this._paused=!1,c.timer.init()),this},isPaused:function(){return this._paused},timer:{prev:+(new Date),current:+(new Date),curTime:Date.now(),init:function(){var b=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||null;b?(k=function(){c.timer.step(),l=b(k)},k()):k=setInterval(c.timer.step,1e3/e)},stop:function(){c.trigger("CraftyStop"),typeof k=="number"&&clearInterval(k);var b=a.cancelRequestAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||null;b&&b(l),k=null},step:function(){n=0,this.curTime=Date.now(),this.curTime-p>60*o&&(p=this.curTime-o);while(this.curTime>p)c.trigger("EnterFrame",{frame:f++}),p+=o,n++;n&&c.DrawManager.draw()},getFPS:function(){return e},simulateFrames:function(a){while(a-->0)c.trigger("EnterFrame",{frame:f++});c.DrawManager.draw()}},e:function(){var a=t(),b;return h[a]=null,h[a]=b=c(a),arguments.length>0&&b.addComponent.apply(b,arguments),b.setName("Entity #"+a),b.addComponent("obj"),c.trigger("NewEntity",{id:a}),b},c:function(a,b){g[a]=b},trigger:function(a,b){var d=i[a],e,f,g;for(e in d){if(!d.hasOwnProperty(e))continue;for(f=0,g=d[e].length;f<g;f++)d[e]&&d[e][f]&&(h[e]?d[e][f].call(c(+e),b):d[e][f].call(c,b))}},bind:function(a,b){i[a]||(i[a]={});var c=i[a];return c.global||(c.global=[]),c.global.push(b)-1},unbind:function(a,b){var c=i[a],d,e,f;for(d in c){if(!c.hasOwnProperty(d))continue;if(typeof b=="number")return delete c[d][b],!0;for(e=0,f=c[d].length;e<f;e++)if(c[d][e]===b)return delete c[d][e],!0}return!1},frame:function(){return f},components:function(){return g},isComp:function(a){return a in g},debug:function(){return h},settings:function(){var a={},b={};return{register:function(a,c){b[a]=c},modify:function(c,d){if(!b[c])return;b[c].call(a[c],d),a[c]=d},get:function(b){return a[b]}}}(),clone:u}),c.bind("Load",function(){!c.support.setter&&c.support.defineProperty&&(m=[],c.bind("EnterFrame",function(){var a=0,b=m.length,c;for(;a<b;++a)c=m[a],c.obj[c.prop]!==c.obj["_"+c.prop]&&c.fn.call(c.obj,c.obj[c.prop])}))}),a.Crafty=c}(window),function(Crafty,window,document){function tweenEnterFrame(a){if(this._numProps<=0)return;var b,c;for(c in this._step)b=this._step[c],this[c]+=b.val,--b.rem==0&&(this[c]=b.prop,this.trigger("TweenEnd",c),this._step[c].rem<=0&&delete this._step[c],this._numProps--);if(this.has("Mouse")){var d=Crafty.over,e=Crafty.mousePos;d&&d[0]==this[0]&&!this.isAt(e.x,e.y)?(this.trigger("MouseOut",Crafty.lastEvent),Crafty.over=null):(!d||d[0]!=this[0])&&this.isAt(e.x,e.y)&&(Crafty.over=this,this.trigger("MouseOver",Crafty.lastEvent))}}(function(a){function e(a,b,c){this.keys=a,this.map=c,this.obj=b}var b,c=function(a){b=a||64,this.map={}},d=" ";c.prototype={insert:function(a){var b=c.key(a),f=new e(b,a,this),g=0,h,i;for(g=b.x1;g<=b.x2;g++)for(h=b.y1;h<=b.y2;h++)i=g+d+h,this.map[i]||(this.map[i]=[]),this.map[i].push(a);return f},search:function(a,b){var e=c.key(a),f,g,h,i=[];b===undefined&&(b=!0);for(f=e.x1;f<=e.x2;f++)for(g=e.y1;g<=e.y2;g++)h=f+d+g,this.map[h]&&(i=i.concat(this.map[h]));if(b){var j,k,m=[],n={};for(f=0,l=i.length;f<l;f++){j=i[f];if(!j)continue;k=j[0],!n[k]&&j.x<a._x+a._w&&j._x+j._w>a._x&&j.y<a._y+a._h&&j._h+j._y>a._y&&(n[k]=i[f])}for(j in n)m.push(n[j]);return m}return i},remove:function(a,b){var e=0,f,g;arguments.length==1&&(b=a,a=c.key(b));for(e=a.x1;e<=a.x2;e++)for(f=a.y1;f<=a.y2;f++){g=e+d+f;if(this.map[g]){var h=this.map[g],i,j=h.length;for(i=0;i<j;i++)h[i]&&h[i][0]===b[0]&&h.splice(i,1)}}},boundaries:function(){var a,b,c={max:{x:-Infinity,y:-Infinity},min:{x:Infinity,y:Infinity}},e={max:{x:-Infinity,y:-Infinity},min:{x:Infinity,y:Infinity}};for(var f in this.map){if(!this.map[f].length)continue;var g=f.split(d),h=g[0],i=g[0];if(h>=c.max.x){c.max.x=h;for(a in this.map[f])b=this.map[f][a],typeof b=="object"&&"requires"in b&&(e.max.x=Math.max(e.max.x,b.x+b.w))}if(h<=c.min.x){c.min.x=h;for(a in this.map[f])b=this.map[f][a],typeof b=="object"&&"requires"in b&&(e.min.x=Math.min(e.min.x,b.x))}if(i>=c.max.y){c.max.y=i;for(a in this.map[f])b=this.map[f][a],typeof b=="object"&&"requires"in b&&(e.max.y=Math.max(e.max.y,b.y+b.h))}if(i<=c.min.y){c.min.y=i;for(a in this.map[f])b=this.map[f][a],typeof b=="object"&&"requires"in b&&(e.min.y=Math.min(e.min.y,b.y))}}return e}},c.key=function(a){a.hasOwnProperty("mbr")&&(a=a.mbr());var c=Math.floor(a._x/b),d=Math.floor(a._y/b),e=Math.floor((a._w+a._x)/b),f=Math.floor((a._h+a._y)/b);return{x1:c,y1:d,x2:e,y2:f}},c.hash=function(a){return a.x1+d+a.y1+d+a.x2+d+a.y2},e.prototype={update:function(a){if(c.hash(c.key(a))!=c.hash(this.keys)){this.map.remove(this.keys,this.obj);var b=this.map.insert(this.obj);this.keys=b.keys}}},a.HashMap=c})(Crafty),Crafty.map=new Crafty.HashMap;var M=Math,Mc=M.cos,Ms=M.sin,PI=M.PI,DEG_TO_RAD=PI/180;Crafty.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_rotation:0,_alpha:1,_visible:!0,_globalZ:null,_origin:null,_mbr:null,_entry:null,_children:null,_parent:null,_changed:!1,_defineGetterSetter_setter:function(){this.__defineSetter__("x",function(a){this._attr("_x",a)}),this.__defineSetter__("y",function(a){this._attr("_y",a)}),this.__defineSetter__("w",function(a){this._attr("_w",a)}),this.__defineSetter__("h",function(a){this._attr("_h",a)}),this.__defineSetter__("z",function(a){this._attr("_z",a)}),this.__defineSetter__("rotation",function(a){this._attr("_rotation",a)}),this.__defineSetter__("alpha",function(a){this._attr("_alpha",a)}),this.__defineSetter__("visible",function(a){this._attr("_visible",a)}),this.__defineGetter__("x",function(){return this._x}),this.__defineGetter__("y",function(){return this._y}),this.__defineGetter__("w",function(){return this._w}),this.__defineGetter__("h",function(){return this._h}),this.__defineGetter__("z",function(){return this._z}),this.__defineGetter__("rotation",function(){return this._rotation}),this.__defineGetter__("alpha",function(){return this._alpha}),this.__defineGetter__("visible",function(){return this._visible}),this.__defineGetter__("parent",function(){return this._parent}),this.__defineGetter__("numChildren",function(){return this._children.length})},_defineGetterSetter_defineProperty:function(){Object.defineProperty(this,"x",{set:function(a){this._attr("_x",a)},get:function(){return this._x},configurable:!0}),Object.defineProperty(this,"y",{set:function(a){this._attr("_y",a)},get:function(){return this._y},configurable:!0}),Object.defineProperty(this,"w",{set:function(a){this._attr("_w",a)},get:function(){return this._w},configurable:!0}),Object.defineProperty(this,"h",{set:function(a){this._attr("_h",a)},get:function(){return this._h},configurable:!0}),Object.defineProperty(this,"z",{set:function(a){this._attr("_z",a)},get:function(){return this._z},configurable:!0}),Object.defineProperty(this,"rotation",{set:function(a){this._attr("_rotation",a)},get:function(){return this._rotation},configurable:!0}),Object.defineProperty(this,"alpha",{set:function(a){this._attr("_alpha",a)},get:function(){return this._alpha},configurable:!0}),Object.defineProperty(this,"visible",{set:function(a){this._attr("_visible",a)},get:function(){return this._visible},configurable:!0})},_defineGetterSetter_fallback:function(){this.x=this._x,this.y=this._y,this.w=this._w,this.h=this._h,this.z=this._z,this.rotation=this._rotation,this.alpha=this._alpha,this.visible=this._visible,this.bind("EnterFrame",function(){if(this.x!==this._x||this.y!==this._y||this.w!==this._w||this.h!==this._h||this.z!==this._z||this.rotation!==this._rotation||this.alpha!==this._alpha||this.visible!==this._visible){var a=this.mbr()||this.pos();if(this.rotation!==this._rotation)this._rotate(this.rotation);else{var b=this._mbr,c=!1;b&&(this.x!==this._x?(b._x-=this.x-this._x,c=!0):this.y!==this._y?(b._y-=this.y-this._y,c=!0):this.w!==this._w?(b._w-=this.w-this._w,c=!0):this.h!==this._h?(b._h-=this.h-this._h,c=!0):this.z!==this._z&&(b._z-=this.z-this._z,c=!0)),c&&this.trigger("Move",a)}this._x=this.x,this._y=this.y,this._w=this.w,this._h=this.h,this._z=this.z,this._rotation=this.rotation,this._alpha=this.alpha,this._visible=this.visible,this.trigger("Change",a),this.trigger("Move",a)}})},init:function(){this._globalZ=this[0],this._origin={x:0,y:0},this._children=[],Crafty.support.setter?this._defineGetterSetter_setter():Crafty.support.defineProperty?this._defineGetterSetter_defineProperty():this._defineGetterSetter_fallback(),this._entry=Crafty.map.insert(this),this.bind("Move",function(a){var b=this._mbr||this;this._entry.update(b),this._cascade(a)}),this.bind("Rotate",function(a){var b=this._mbr||this;this._entry.update(b),this._cascade(a)}),this.bind("Remove",function(){if(this._children){for(var a=0;a<this._children.length;a++)this._children[a].destroy&&this._children[a].destroy();this._children=[]}Crafty.map.remove(this),this.detach()})},_rotate:function(a){var b=-1*(a%360),c=b*DEG_TO_RAD,d=Math.cos(c),e=Math.sin(c),f={x:this._origin.x+this._x,y:this._origin.y+this._y};if(!b){this._mbr=null;if(!this._rotation%360)return}var g=f.x+(this._x-f.x)*d+(this._y-f.y)*e,h=f.y-(this._x-f.x)*e+(this._y-f.y)*d,i=f.x+(this._x+this._w-f.x)*d+(this._y-f.y)*e,j=f.y-(this._x+this._w-f.x)*e+(this._y-f.y)*d,k=f.x+(this._x+this._w-f.x)*d+(this._y+this._h-f.y)*e,l=f.y-(this._x+this._w-f.x)*e+(this._y+this._h-f.y)*d,m=f.x+(this._x-f.x)*d+(this._y+this._h-f.y)*e,n=f.y-(this._x-f.x)*e+(this._y+this._h-f.y)*d,o=Math.floor(Math.min(g,i,k,m)),p=Math.floor(Math.min(h,j,l,n)),q=Math.ceil(Math.max(g,i,k,m)),r=Math.ceil(Math.max(h,j,l,n));this._mbr={_x:o,_y:p,_w:q-o,_h:r-p};var s=this._rotation-a,t=s*DEG_TO_RAD;this.trigger("Rotate",{cos:Math.cos(t),sin:Math.sin(t),deg:s,rad:t,o:{x:f.x,y:f.y},matrix:{M11:d,M12:e,M21:-e,M22:d}})},area:function(){return this._w*this._h},intersect:function(a,b,c,d){var e,f=this._mbr||this;return typeof a=="object"?e=a:e={x:a,y:b,w:c,h:d},f._x<e.x+e.w&&f._x+f._w>e.x&&f._y<e.y+e.h&&f._h+f._y>e.y},within:function(a,b,c,d){var e;return typeof a=="object"?e=a:e={x:a,y:b,w:c,h:d},e.x<=this.x&&e.x+e.w>=this.x+this.w&&e.y<=this.y&&e.y+e.h>=this.y+this.h},contains:function(a,b,c,d){var e;return typeof a=="object"?e=a:e={x:a,y:b,w:c,h:d},e.x>=this.x&&e.x+e.w<=this.x+this.w&&e.y>=this.y&&e.y+e.h<=this.y+this.h},pos:function(){return{_x:this._x,_y:this._y,_w:this._w,_h:this._h}},mbr:function(){return this._mbr?{_x:this._mbr._x,_y:this._mbr._y,_w:this._mbr._w,_h:this._mbr._h}:this.pos()},isAt:function(a,b){return this.mapArea?this.mapArea.containsPoint(a,b):this.map?this.map.containsPoint(a,b):this.x<=a&&this.x+this.w>=a&&this.y<=b&&this.y+this.h>=b},move:function(a,b){a.charAt(0)==="n"&&(this.y-=b),a.charAt(0)==="s"&&(this.y+=b);if(a==="e"||a.charAt(1)==="e")this.x+=b;if(a==="w"||a.charAt(1)==="w")this.x-=b;return this},shift:function(a,b,c,d){return a&&(this.x+=a),b&&(this.y+=b),c&&(this.w+=c),d&&(this.h+=d),this},_cascade:function(a){if(!a)return;var b=0,c=this._children,d=c.length,e;if(a.cos)for(;b<d;++b)e=c[b],"rotate"in e&&e.rotate(a);else{var f=this._mbr||this,g=f._x-a._x,h=f._y-a._y,i=f._w-a._w,j=f._h-a._h;for(;b<d;++b)e=c[b],e.shift(g,h,i,j)}},attach:function(){var a=0,b=arguments,c=arguments.length,d;for(;a<c;++a)d=b[a],d._parent&&d._parent.detach(d),d._parent=this,this._children.push(d);return this},detach:function(a){if(!a){for(var b=0;b<this._children.length;b++)this._children[b]._parent=null;return this._children=[],this}for(var b=0;b<this._children.length;b++)this._children[b]==a&&this._children.splice(b,1);return a._parent=null,this},origin:function(a,b){if(typeof a=="string")if(a==="centre"||a==="center"||a.indexOf(" ")===-1)a=this._w/2,b=this._h/2;else{var c=a.split(" ");if(c[0]==="top")b=0;else if(c[0]==="bottom")b=this._h;else if(c[0]==="middle"||c[1]==="center"||c[1]==="centre")b=this._h/2;c[1]==="center"||c[1]==="centre"||c[1]==="middle"?a=this._w/2:c[1]==="left"?a=0:c[1]==="right"&&(a=this._w)}return this._origin.x=a,this._origin.y=b,this},flip:function(a){a=a||"X",this["_flip"+a]||(this["_flip"+a]=!0,this.trigger("Change"))},unflip:function(a){a=a||"X",this["_flip"+a]&&(this["_flip"+a]=!1,this.trigger("Change"))},rotate:function(a){this._origin.x=a.o.x-this._x,this._origin.y=a.o.y-this._y,this._attr("_rotation",a.theta)},_attr:function(a,b){var c=this.pos(),d=this.mbr()||c;if(a==="_rotation")this._rotate(b),this.trigger("Rotate");else if(a==="_z")this._globalZ=parseInt(b+Crafty.zeroFill(this[0],5),10),this.trigger("reorder");else if(a=="_x"||a==="_y"||a==="_w"||a==="_h"){var e=this._mbr;e&&(e[a]-=this[a]-b),this[a]=b,this.trigger("Move",d)}this[a]=b,this.trigger("Change",d)}}),Crafty.c("Physics",{_gravity:.4,_friction:.2,_bounce:.5,gravity:function(a){this._gravity=a}}),Crafty.c("Gravity",{_gravityConst:.2,_gy:0,_falling:!0,_anti:null,init:function(){this.requires("2D")},gravity:function(a){return a&&(this._anti=a),this.bind("EnterFrame",this._enterFrame),this},gravityConst:function(a){return this._gravityConst=a,this},_enterFrame:function(){this._falling?(this._gy+=this._gravityConst,this.y+=this._gy):this._gy=0;var a,b=!1,c=this.pos(),d,e=0,f;c._y++,c.x=c._x,c.y=c._y,c.w=c._w,c.h=c._h,d=Crafty.map.search(c),f=d.length;for(;e<f;++e){a=d[e];if(a!==this&&a.has(this._anti)&&a.intersect(c)){b=a;break}}b?this._falling&&this.stopFalling(b):this._falling=!0},stopFalling:function(a){a&&(this.y=a._y-this._h),this._falling=!1,this._up&&(this._up=!1),this.trigger("hit")},antigravity:function(){this.unbind("EnterFrame",this._enterFrame)}}),Crafty.polygon=function(a){arguments.length>1&&(a=Array.prototype.slice.call(arguments,0)),this.points=a},Crafty.polygon.prototype={containsPoint:function(a,b){var c=this.points,d,e,f=!1;for(d=0,e=c.length-1;d<c.length;e=d++)c[d][1]>b!=c[e][1]>b&&a<(c[e][0]-c[d][0])*(b-c[d][1])/(c[e][1]-c[d][1])+c[d][0]&&(f=!f);return f},shift:function(a,b){var c=0,d=this.points.length,e;for(;c<d;c++)e=this.points[c],e[0]+=a,e[1]+=b},rotate:function(a){var b=0,c=this.points.length,d,e,f;for(;b<c;b++)d=this.points[b],e=a.o.x+(d[0]-a.o.x)*a.cos+(d[1]-a.o.y)*a.sin,f=a.o.y-(d[0]-a.o.x)*a.sin+(d[1]-a.o.y)*a.cos,d[0]=e,d[1]=f}},Crafty.circle=function(a,b,c){this.x=a,this.y=b,this.radius=c,this.points=[];var d;for(var e=0;e<8;e++)d=e*Math.PI/4,this.points[e]=[Math.sin(d)*c,Math.cos(d)*c]},Crafty.circle.prototype={containsPoint:function(a,b){var c=this.radius,d=Math.sqrt,e=this.x-a,f=this.y-b;return e*e+f*f<c*c},shift:function(a,b){this.x+=a,this.y+=b;var c=0,d=this.points.length,e;for(;c<d;c++)e=this.points[c],e[0]+=a,e[1]+=b},rotate:function(){}},Crafty.matrix=function(a){this.mtx=a,this.width=a[0].length,this.height=a.length},Crafty.matrix.prototype={x:function(a){if(this.width!=a.height)return;var b=[];for(var c=0;c<this.height;c++){b[c]=[];for(var d=0;d<a.width;d++){var e=0;for(var f=0;f<this.width;f++)e+=this.mtx[c][f]*a.mtx[f][d];b[c][d]=e}}return new Crafty.matrix(b)},e:function(a,b){return a<1||a>this.mtx.length||b<1||b>this.mtx[0].length?null:this.mtx[a-1][b-1]}},Crafty.c("Collision",{init:function(){this.requires("2D");var a=this._mbr||this;poly=new Crafty.polygon([0,0],[a._w,0],[a._w,a._h],[0,a._h]),this.map=poly,this.attach(this.map),this.map.shift(a._x,a._y)},collision:function(a){var b=this._mbr||this;if(!a)return this;if(arguments.length>1){var c=Array.prototype.slice.call(arguments,0);a=new Crafty.polygon(c)}return this.map=a,this.attach(this.map),this.map.shift(b._x,b._y),this},hit:function(a){var b=this._mbr||this,c=Crafty.map.search(b,!1),d=0,e=c.length,f={},g,h,i,j,k="map"in this&&"containsPoint"in this.map,l=[];if(!e)return!1;for(;d<e;++d){h=c[d],i=h._mbr||h;if(!h)continue;g=h[0],!f[g]&&this[0]!==g&&h.__c[a]&&i._x<b._x+b._w&&i._x+i._w>b._x&&i._y<b._y+b._h&&i._h+i._y>b._y&&(f[g]=h)}for(j in f){h=f[j];if(k&&"map"in h){var m=this._SAT(this.map,h.map);m.obj=h,m.type="SAT",m&&l.push(m)}else l.push({obj:h,type:"MBR"})}return l.length?l:!1},onHit:function(a,b,c){var d=!1;return this.bind("EnterFrame",function(){var e=this.hit(a);e?(d=!0,b.call(this,e)):d&&(typeof c=="function"&&c.call(this),d=!1)}),this},_SAT:function(a,b){var c=a.points,d=b.points,e=0,f=c.length,g,h=d.length,i={x:0,y:0},j,k,l,m,n,o,p=null,q=null,r=null,s,t,u;for(;e<f;e++){t=c[e==f-1?0:e+1],u=c[e],i.x=-(t[1]-u[1]),i.y=t[0]-u[0],j=Math.sqrt(i.x*i.x+i.y*i.y),i.x/=j,i.y/=j,k=l=-1,m=n=-1;for(g=0;g<f;++g){s=c[g][0]*i.x+c[g][1]*i.y;if(s>m||m===-1)m=s;if(s<k||k===-1)k=s}for(g=0;g<h;++g){s=d[g][0]*i.x+d[g][1]*i.y;if(s>n||n===-1)n=s;if(s<l||l===-1)l=s}k<l?(o=l-m,i.x=-i.x,i.y=-i.y):o=k-n;if(o>=0)return!1;if(p===null||o>p)p=o,r={x:i.x,y:i.y}}for(e=0;e<h;e++){t=d[e==h-1?0:e+1],u=d[e],i.x=-(t[1]-u[1]),i.y=t[0]-u[0],j=Math.sqrt(i.x*i.x+i.y*i.y),i.x/=j,i.y/=j,k=l=-1,m=n=-1;for(g=0;g<f;++g){s=c[g][0]*i.x+c[g][1]*i.y;if(s>m||m===-1)m=s;if(s<k||k===-1)k=s}for(g=0;g<h;++g){s=d[g][0]*i.x+d[g][1]*i.y;if(s>n||n===-1)n=s;if(s<l||l===-1)l=s}k<l?(o=l-m,i.x=-i.x,i.y=-i.y):o=k-n;if(o>=0)return!1;if(p===null||o>p)p=o;if(o>q||q===null)q=o,r={x:i.x,y:i.y}}return{overlap:q,normal:r}}}),Crafty.c("WiredHitBox",{init:function(){if(Crafty.support.canvas){var a=document.getElementById("HitBox");a||(a=document.createElement("canvas"),a.id="HitBox",a.width=Crafty.viewport.width,a.height=Crafty.viewport.height,a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style.zIndex="1000",Crafty.stage.elem.appendChild(a));var b=a.getContext("2d"),c=0,d=Crafty("WiredHitBox").length;this.requires("Collision").bind("EnterFrame",function(){c==d&&(b.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),c=0),b.beginPath();for(var a in this.map.points)b.lineTo(Crafty.viewport.x+this.map.points[a][0],Crafty.viewport.y+this.map.points[a][1]);b.closePath(),b.stroke(),c++})}return this}}),Crafty.c("SolidHitBox",{init:function(){if(Crafty.support.canvas){var a=document.getElementById("HitBox");a||(a=document.createElement("canvas"),a.id="HitBox",a.width=Crafty.viewport.width,a.height=Crafty.viewport.height,a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style.zIndex="1000",Crafty.stage.elem.appendChild(a));var b=a.getContext("2d"),c=0,d=Crafty("SolidHitBox").length;this.requires("Collision").bind("EnterFrame",function(){c==d&&(b.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),c=0),b.beginPath();for(var a in this.map.points)b.lineTo(Crafty.viewport.x+this.map.points[a][0],Crafty.viewport.y+this.map.points[a][1]);b.closePath(),b.fill(),c++})}return this}}),Crafty.c("DOM",{_element:null,init:function(){function a(){var a=0,b=this.__c,c="";for(a in b)c+=" "+a;c=c.substr(1),this._element.className=c}this._element=document.createElement("div"),Crafty.stage.inner.appendChild(this._element),this._element.style.position="absolute",this._element.id="ent"+this[0],this.bind("Change",function(){this._changed||(this._changed=!0,Crafty.DrawManager.add(this))}),this.bind("NewComponent",a).bind("RemoveComponent",a),Crafty.support.prefix==="ms"&&Crafty.support.version<9&&(this._filters={},this.bind("Rotate",function(a){var b=a.matrix,c=this._element.style,d=b.M11.toFixed(8),e=b.M12.toFixed(8),f=b.M21.toFixed(8),g=b.M22.toFixed(8);this._filters.rotation="progid:DXImageTransform.Microsoft.Matrix(M11="+d+", M12="+e+", M21="+f+", M22="+g+",sizingMethod='auto expand')"})),this.bind("Remove",this.undraw),this.bind("RemoveComponent",function(a){a==="DOM"&&this.undraw()})},getDomId:function(){return this._element.id},DOM:function(a){return a&&a.nodeType&&(this.undraw(),this._element=a,this._element.style.position="absolute"),this},draw:function(){var a=this._element.style,b=this.__coord||[0,0,0,0],c={x:b[0],y:b[1]},d=Crafty.support.prefix,e=[];this._visible?a.visibility="visible":a.visibility="hidden",Crafty.support.css3dtransform?e.push("translate3d("+~~this._x+"px,"+~~this._y+"px,0)"):(a.left=~~this._x+"px",a.top=~~this._y+"px"),a.width=~~this._w+"px",a.height=~~this._h+"px",a.zIndex=this._z,a.opacity=this._alpha,a[d+"Opacity"]=this._alpha,d==="ms"&&Crafty.support.version<9&&(Crafty.support.version===8?this._filters.alpha="progid:DXImageTransform.Microsoft.Alpha(Opacity="+this._alpha*100+")":this._filters.alpha="alpha(opacity="+this._alpha*100+")");if(this._mbr){var f=this._origin.x+"px "+this._origin.y+"px";a.transformOrigin=f,a[d+"TransformOrigin"]=f,Crafty.support.css3dtransform?e.push("rotateZ("+this._rotation+"deg)"):e.push("rotate("+this._rotation+"deg)")}return this._flipX&&(e.push("scaleX(-1)"),d==="ms"&&Crafty.support.version<9&&(this._filters.flipX="fliph")),this._flipY&&(e.push("scaleY(-1)"),d==="ms"&&Crafty.support.version<9&&(this._filters.flipY="flipv")),d==="ms"&&Crafty.support.version<9&&this.applyFilters(),a.transform=e.join(" "),a[d+"Transform"]=e.join(" "),this.trigger("Draw",{style:a,type:"DOM",co:c}),this},applyFilters:function(){this._element.style.filter="";var a="";for(var b in this._filters){if(!this._filters.hasOwnProperty(b))continue;a+=this._filters[b]+" "}this._element.style.filter=a},undraw:function(){return this._element&&Crafty.stage.inner.removeChild(this._element),this},css:function(a,b){var c,d=this._element,e,f=d.style;if(typeof a=="object")for(c in a){if(!a.hasOwnProperty(c))continue;e=a[c],typeof e=="number"&&(e+="px"),f[Crafty.DOM.camelize(c)]=e}else{if(!b)return Crafty.DOM.getStyle(d,a);typeof b=="number"&&(b+="px"),f[Crafty.DOM.camelize(a)]=b}return this.trigger("Change"),this}});try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}Crafty.extend({DOM:{window:{init:function(){this.width=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,this.height=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight},width:0,height:0},inner:function(a){var b=a.getBoundingClientRect(),c=b.left+(window.pageXOffset?window.pageXOffset:document.body.scrollLeft),d=b.top+(window.pageYOffset?window.pageYOffset:document.body.scrollTop),e=parseInt(this.getStyle(a,"border-left-width")||0,10)||parseInt(this.getStyle(a,"borderLeftWidth")||0,10)||0,f=parseInt(this.getStyle(a,"border-top-width")||0,10)||parseInt(this.getStyle(a,"borderTopWidth")||0,10)||0;return c+=e,d+=f,{x:c,y:d}},getStyle:function(a,b){var c;return a.currentStyle?c=a.currentStyle[this.camelize(b)]:window.getComputedStyle&&(c=document.defaultView.getComputedStyle(a,null).getPropertyValue(this.csselize(b))),c},camelize:function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})},csselize:function(a){return a.replace(/[A-Z]/g,function(a){return a?"-"+a.toLowerCase():""})},translate:function(a,b){return{x:(a-Crafty.stage.x+document.body.scrollLeft+document.documentElement.scrollLeft-Crafty.viewport._x)/Crafty.viewport._zoom,y:(b-Crafty.stage.y+document.body.scrollTop+document.documentElement.scrollTop-Crafty.viewport._y)/Crafty.viewport._zoom}}}}),Crafty.c("HTML",{inner:"",init:function(){this.requires("2D, DOM")},replace:function(a){return this.inner=a,this._element.innerHTML=a,this},append:function(a){return this.inner+=a,this._element.innerHTML+=a,this},prepend:function(a){return this.inner=a+this.inner,this._element.innerHTML=a+this.inner,this}}),Crafty.storage=function(){function process(a){if(a.c){var b=Crafty.e(a.c).attr(a.attr).trigger("LoadData",a,process);return b}if(typeof a=="object")for(var c in a)a[c]=process(a[c]);return a}function unserialize(str){if(typeof str!="string")return null;var data=JSON?JSON.parse(str):eval("("+str+")");return process(data)}function prep(a){if(a.__c){var b={c:[],attr:{}};a.trigger("SaveData",b,prep);for(var c in a.__c)b.c.push(c);b.c=b.c.join(", "),a=b}else if(typeof a=="object")for(var d in a)a[d]=prep(a[d]);return a}function serialize(a){if(JSON){var b=prep(a);return JSON.stringify(b)}return alert("Crafty does not support saving on your browser. Please upgrade to a newer browser."),!1}function external(a){url=a}function openExternal(){if(typeof url=="undefined")return;var xml=new XMLHttpRequest;xhr.open("POST",url),xhr.onreadystatechange=function(evt){if(xhr.readyState==4&&xhr.status==200){var data=eval("("+xhr.responseText+")");for(var i in data)Crafty.storage.check(data[i].key,data[i].timestamp)&&loadExternal(data[i].key)}},xhr.send("mode=timestamps&game="+gameName)}function saveExternal(a,b,c){if(typeof url=="undefined")return;var d=new XMLHttpRequest;d.open("POST",url),d.send("mode=save&key="+a+"&data="+encodeURIComponent(b)+"&ts="+c+"&game="+gameName)}function loadExternal(key){if(typeof url=="undefined")return;var xhr=new XMLHttpRequest;xhr.open("POST",url),xhr.onreadystatechange=function(evt){if(xhr.readyState==4&&xhr.status==200){var data=eval("("+xhr.responseText+")");Crafty.storage.save(key,"save",data)}},xhr.send("mode=load&key="+key+"&game="+gameName)}function ts(){var a=new Date;return a.getTime()}var db=null,url,gameName,timestamps={};return typeof indexedDB!="object"&&(typeof mozIndexedDB=="object"&&(window.indexedDB=mozIndexedDB),typeof webkitIndexedDB=="object"&&(window.indexedDB=webkitIndexedDB,window.IDBTransaction=webkitIDBTransaction)),typeof indexedDB=="object"?{open:function(a){function d(){try{var a=db.transaction(["save"],IDBTransaction.READ),b=a.objectStore("save"),c=b.getAll();c.onsuccess=function(a){var b=0,c=event.target.result,d=c.length;for(;b<d;b++)timestamps[c[b].key]=c[b].timestamp}}catch(d){}}function e(){var a=db.setVersion("1.0");a.onsuccess=function(a){for(var c=0;c<b.length;c++){var d=b[c];if(db.objectStoreNames.contains(d))continue;db.createObjectStore(d,{keyPath:"key"})}}}gameName=a;var b=[];arguments.length==1?(b.push("save"),b.
push("cache")):(b=arguments,b.shift(),b.push("save"),b.push("cache"));if(db==null){var c=indexedDB.open(gameName,"Database for "+gameName);c.onsuccess=function(a){db=a.target.result,e(),d(),openExternal()}}else e(),d(),openExternal()},save:function(a,b,c){if(db==null){setTimeout(function(){Crafty.storage.save(a,b,c)},1);return}var d=serialize(c),e=ts();b=="save"&&saveExternal(a,d,e);try{var f=db.transaction([b],IDBTransaction.READ_WRITE),g=f.objectStore(b),h=g.put({data:d,timestamp:e,key:a})}catch(i){console.error(i)}},load:function(a,b,c){if(db==null){setTimeout(function(){Crafty.storage.load(a,b,c)},1);return}try{var d=db.transaction([b],IDBTransaction.READ),e=d.objectStore(b),f=e.get(a);f.onsuccess=function(a){c(unserialize(a.target.result.data))}}catch(g){console.error(g)}},getAllKeys:function(a,b){db==null&&setTimeout(function(){Crafty.storage.getAllkeys(a,b)},1);try{var c=db.transaction([a],IDBTransaction.READ),d=c.objectStore(a),e=d.getCursor(),f=[];e.onsuccess=function(a){var c=a.target.result;c?(f.push(c.key),c["continue"]()):b(f)}}catch(g){console.error(g)}},check:function(a,b){return timestamps[a]>b},external:external}:typeof openDatabase=="function"?{open:function(a){gameName=a;if(arguments.length==1)db={save:openDatabase(a+"_save","1.0","Saves games for "+a,5242880),cache:openDatabase(a+"_cache","1.0","Cache for "+a,5242880)};else{var b=arguments,c=0;b.shift();for(;c<b.length;c++)typeof db[b[c]]=="undefined"&&(db[b[c]]=openDatabase(gameName+"_"+b[c],"1.0",type,5242880))}db.save.transaction(function(a){a.executeSql("SELECT key, timestamp FROM data",[],function(a,b){var c=0,d=b.rows,e=d.length;for(;c<e;c++)timestamps[d.item(c).key]=d.item(c).timestamp})})},save:function(a,b,c){typeof db[b]=="undefined"&&gameName!=""&&this.open(gameName,b);var d=serialize(c),e=ts();b=="save"&&saveExternal(a,d,e),db[b].transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS data (key unique, text, timestamp)"),b.executeSql("SELECT * FROM data WHERE key = ?",[a],function(b,c){c.rows.length?b.executeSql("UPDATE data SET text = ?, timestamp = ? WHERE key = ?",[d,e,a]):b.executeSql("INSERT INTO data VALUES (?, ?, ?)",[a,d,e])})})},load:function(a,b,c){if(db[b]==null){setTimeout(function(){Crafty.storage.load(a,b,c)},1);return}db[b].transaction(function(b){b.executeSql("SELECT text FROM data WHERE key = ?",[a],function(a,b){b.rows.length&&(res=unserialize(b.rows.item(0).text),c(res))})})},getAllKeys:function(a,b){if(db[a]==null){setTimeout(function(){Crafty.storage.getAllKeys(a,b)},1);return}db[a].transaction(function(a){a.executeSql("SELECT key FROM data",[],function(a,c){b(c.rows)})})},check:function(a,b){return timestamps[a]>b},external:external}:typeof window.localStorage=="object"?{open:function(a){gameName=a},save:function(a,b,c){var d=gameName+"."+b+"."+a,e=serialize(c),f=ts();b=="save"&&saveExternal(a,e,f),window.localStorage[d]=e,b=="save"&&(window.localStorage[d+".ts"]=f)},load:function(a,b,c){var d=gameName+"."+b+"."+a,e=window.localStorage[d];c(unserialize(e))},getAllKeys:function(a,b){var c={},d=[],e=gameName+"."+a;for(var f in window.localStorage)if(f.indexOf(e)!=-1){var g=f.replace(e,"").replace(".ts","");c[g]=!0}for(f in c)d.push(f);b(d)},check:function(a,b){var c=window.localStorage[gameName+".save."+a+".ts"];return parseInt(b)>parseInt(c)},external:external}:{open:function(a){gameName=a},save:function(a,b,c){if(b!="save")return;var d=serialize(c),e=ts();b=="save"&&saveExternal(a,d,e),document.cookie=gameName+"_"+a+"="+d+"; "+gameName+"_"+a+"_ts="+e+"; expires=Thur, 31 Dec 2099 23:59:59 UTC; path=/"},load:function(a,b,c){if(b!="save")return;var d=new RegExp(gameName+"_"+a+"=[^;]*"),e=d.exec(document.cookie),f=unserialize(e[0].replace(gameName+"_"+a+"=",""));c(f)},getAllKeys:function(a,b){if(a!="save")return;var c=new RegExp(gameName+"_[^_=]","g"),d=c.exec(document.cookie),e=0,f=d.length,g={},h=[];for(;e<f;e++){var i=d[e].replace(gameName+"_","");g[i]=!0}for(e in g)h.push(e);b(h)},check:function(a,b){var c=gameName+"_"+a+"_ts",d=new RegExp(c+"=[^;]"),e=d.exec(document.cookie),f=e[0].replace(c+"=","");return parseInt(b)>parseInt(f)},external:external}}(),function(){var b=Crafty.support={},c=navigator.userAgent.toLowerCase(),d=/(webkit)[ \/]([\w.]+)/.exec(c)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(c)||/(ms)ie ([\w.]+)/.exec(c)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(c)||[],e=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(c);e&&(Crafty.mobile=e[0]),b.setter="__defineSetter__"in this&&"__defineGetter__"in this,b.defineProperty=function(){if(!1 in Object)return!1;try{Object.defineProperty({},"x",{})}catch(a){return!1}return!0}(),b.audio="Audio"in window,b.prefix=d[1]||d[0],b.prefix==="moz"&&(b.prefix="Moz"),b.prefix==="o"&&(b.prefix="O"),d[2]&&(b.versionName=d[2],b.version=+d[2].split(".")[0]),b.canvas="getContext"in document.createElement("canvas");if(b.canvas){var f;try{f=document.createElement("canvas").getContext("experimental-webgl"),f.viewportWidth=canvas.width,f.viewportHeight=canvas.height}catch(g){}b.webgl=!!f}else b.webgl=!1;b.css3dtransform=typeof document.createElement("div").style.Perspective!="undefined"||typeof document.createElement("div").style[b.prefix+"Perspective"]!="undefined",b.deviceorientation=typeof window.DeviceOrientationEvent!="undefined"||typeof window.OrientationEvent!="undefined",b.devicemotion=typeof window.DeviceMotionEvent!="undefined"}(),Crafty.extend({zeroFill:function(a,b){return b-=a.toString().length,b>0?(new Array(b+(/\./.test(a)?2:1))).join("0")+a:a.toString()},sprite:function(a,b,c,d,e,f){var g,h,i,j,k,l,m;typeof a=="string"&&(f=e,e=d,d=b,c=a,a=1,b=1),typeof b=="string"&&(f=e,e=d,d=c,c=b,b=a),!f&&e&&(f=e),e=parseInt(e||0,10),f=parseInt(f||0,10),m=Crafty.asset(c),m||(m=new Image,m.src=c,Crafty.asset(c,m),m.onload=function(){for(g in d)Crafty(g).each(function(){this.ready=!0,this.trigger("Change")})});for(g in d){if(!d.hasOwnProperty(g))continue;h=d[g],i=h[0]*(a+e),j=h[1]*(b+f),k=h[2]*a||a,l=h[3]*b||b,Crafty.c(g,{ready:!1,__coord:[i,j,k,l],init:function(){this.requires("Sprite"),this.__trim=[0,0,0,0],this.__image=c,this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]],this.__tile=a,this.__tileh=b,this.__padding=[e,f],this.img=m,this.img.complete&&this.img.width>0&&(this.ready=!0,this.trigger("Change")),this.w=this.__coord[2],this.h=this.__coord[3]}})}return this},_events:{},addEvent:function(a,b,c,d){arguments.length===3&&(d=c,c=b,b=window.document);var e=function(b){var b=b||window.event;typeof d=="function"&&d.call(a,b)},f=a[0]||"";if(!!this._events[f+b+c+d])return;this._events[f+b+c+d]=e,b.attachEvent?b.attachEvent("on"+c,e):b.addEventListener(c,e,!1)},removeEvent:function(a,b,c,d){arguments.length===3&&(d=c,c=b,b=window.document);var e=a[0]||"",f=this._events[e+b+c+d];f&&(b.detachEvent?b.detachEvent("on"+c,f):b.removeEventListener(c,f,!1),delete this._events[e+b+c+d])},background:function(a){Crafty.stage.elem.style.background=a},viewport:{clampToEntities:!0,width:0,height:0,_x:0,_y:0,scroll:function(a,b){b=Math.floor(b);var c=b-this[a],d=Crafty.canvas.context,e=Crafty.stage.inner.style,f;this[a]=b,a=="_x"?d&&d.translate(c,0):d&&d.translate(0,c),d&&Crafty.DrawManager.drawAll(),e[a=="_x"?"left":"top"]=b+"px"},rect:function(){return{_x:-this._x,_y:-this._y,_w:this.width,_h:this.height}},pan:function(){function d(c){var d=0;for(b in a){var e=a[b];e.remTime>0?(e.current+=e.diff,e.remTime--,Crafty.viewport[b]=Math.floor(e.current),d++):delete a[b]}d&&Crafty.viewport._clamp()}var a={},b,c=!1;return function(e,f,g){Crafty.viewport.follow();if(e=="reset"){for(b in a)a[b].remTime=0;return}g==0&&(g=1),a[e]={diff:-f/g,current:Crafty.viewport[e],remTime:g},c||(Crafty.bind("EnterFrame",d),c=!0)}}(),follow:function(){function d(){Crafty.viewport.scroll("_x",-(this.x+this.w/2-Crafty.viewport.width/2-b)),Crafty.viewport.scroll("_y",-(this.y+this.h/2-Crafty.viewport.height/2-c)),Crafty.viewport._clamp()}var a,b,c;return function(e,f,g){a&&a.unbind("Change",d);if(!e||!e.has("2D"))return;Crafty.viewport.pan("reset"),a=e,b=typeof f!="undefined"?f:0,c=typeof g!="undefined"?g:0,e.bind("Change",d),d.call(e)}}(),centerOn:function(a,b){var c=a.x,d=a.y,e=a.w/2,f=a.h/2,g=Crafty.viewport.width/2,h=Crafty.viewport.height/2,i=c+e-g,j=d+f-h;Crafty.viewport.pan("reset"),Crafty.viewport.pan("x",i,b),Crafty.viewport.pan("y",j,b)},_zoom:1,zoom:function(){function h(){if(c>0){var e={width:f.width*a,height:f.height*a};a+=b,this._zoom=a;var h={width:f.width*a,height:f.height*a},i={width:h.width-e.width,height:h.height-e.height};Crafty.stage.inner.style[d]="scale("+a+","+a+")",Crafty.canvas._canvas&&(Crafty.canvas.context.scale(a,a),Crafty.DrawManager.drawAll()),Crafty.viewport.x-=i.width*g.width,Crafty.viewport.y-=i.height*g.height,c--}}var a=1,b=0,c=0,d=Crafty.support.prefix+"Transform",e=!1,f={},g={};return function(d,i,j,k){var l=Crafty.map.boundaries(),m=d?a*d:1;f.width=l.max.x-l.min.x,f.height=l.max.y-l.min.y,g.width=i/f.width,g.height=j/f.height,k==0&&(k=1),b=(m-a)/k,c=k,Crafty.viewport.pan("reset"),e||(Crafty.bind("EnterFrame",h),e=!0)}}(),scale:function(){var a=Crafty.support.prefix+"Transform",b={};return function(c){var d=Crafty.map.boundaries(),e=c?this._zoom*c:1;this._zoom=e,b.width=d.max.x-d.min.x,b.height=d.max.y-d.min.y;var f={width:b.width*e,height:b.height*e};Crafty.viewport.pan("reset"),Crafty.stage.inner.style[a]="scale("+this._zoom+","+this._zoom+")",Crafty.stage.elem.style.width=f.width+"px",Crafty.stage.elem.style.height=f.height+"px",Crafty.canvas._canvas&&(Crafty.canvas._canvas.width=f.width,Crafty.canvas._canvas.height=f.height,Crafty.canvas.context.scale(this._zoom,this._zoom),Crafty.DrawManager.drawAll()),Crafty.viewport.width=f.width,Crafty.viewport.height=f.height}}(),mouselook:function(){var a=!1,b=!1,c={};return old={},function(d,e){if(typeof d=="boolean"){a=d,a?Crafty.mouseObjs++:Crafty.mouseObjs=Math.max(0,Crafty.mouseObjs-1);return}if(!a)return;switch(d){case"move":case"drag":if(!b)return;diff={x:e.clientX-c.x,y:e.clientY-c.y},Crafty.viewport.x+=diff.x,Crafty.viewport.y+=diff.y,Crafty.viewport._clamp();case"start":c.x=e.clientX,c.y=e.clientY,b=!0;break;case"stop":b=!1}}}(),_clamp:function(){if(!this.clampToEntities)return;var a=Crafty.map.boundaries();a.max.x-a.min.x>Crafty.viewport.width?(a.max.x-=Crafty.viewport.width,Crafty.viewport.x<-a.max.x?Crafty.viewport.x=-a.max.x:Crafty.viewport.x>-a.min.x&&(Crafty.viewport.x=-a.min.x)):Crafty.viewport.x=-1*(a.min.x+(a.max.x-a.min.x)/2-Crafty.viewport.width/2),a.max.y-a.min.y>Crafty.viewport.height?(a.max.y-=Crafty.viewport.height,Crafty.viewport.y<-a.max.y?Crafty.viewport.y=-a.max.y:Crafty.viewport.y>-a.min.y&&(Crafty.viewport.y=-a.min.y)):Crafty.viewport.y=-1*(a.min.y+(a.max.y-a.min.y)/2-Crafty.viewport.height/2)},init:function(a,b){Crafty.DOM.window.init(),this.width=!a||Crafty.mobile?Crafty.DOM.window.width:a,this.height=!b||Crafty.mobile?Crafty.DOM.window.height:b;var c=document.getElementById("cr-stage");Crafty.stage={x:0,y:0,fullscreen:!1,elem:c?c:document.createElement("div"),inner:document.createElement("div")};if(!a&&!b||Crafty.mobile)document.body.style.overflow="hidden",Crafty.stage.fullscreen=!0;Crafty.addEvent(this,window,"resize",Crafty.viewport.reload),Crafty.addEvent(this,window,"blur",function(){Crafty.settings.get("autoPause")&&Crafty.pause()}),Crafty.addEvent(this,window,"focus",function(){Crafty._paused&&Crafty.settings.get("autoPause")&&Crafty.pause()}),Crafty.settings.register("stageSelectable",function(a){Crafty.stage.elem.onselectstart=a?function(){return!0}:function(){return!1}}),Crafty.settings.modify("stageSelectable",!1),Crafty.settings.register("stageContextMenu",function(a){Crafty.stage.elem.oncontextmenu=a?function(){return!0}:function(){return!1}}),Crafty.settings.modify("stageContextMenu",!1),Crafty.settings.register("autoPause",function(){}),Crafty.settings.modify("autoPause",!1),c||(document.body.appendChild(Crafty.stage.elem),Crafty.stage.elem.id="cr-stage");var d=Crafty.stage.elem.style,e;Crafty.stage.elem.appendChild(Crafty.stage.inner),Crafty.stage.inner.style.position="absolute",Crafty.stage.inner.style.zIndex="1",d.width=this.width+"px",d.height=this.height+"px",d.overflow="hidden";if(Crafty.mobile){d.position="absolute",d.left="0px",d.top="0px";var f=document.createElement("meta"),g=document.getElementsByTagName("HEAD")[0];f.setAttribute("name","viewport"),f.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"),g.appendChild(f),f=document.createElement("meta"),f.setAttribute("name","apple-mobile-web-app-capable"),f.setAttribute("content","yes"),g.appendChild(f),setTimeout(function(){window.scrollTo(0,1)},0),Crafty.addEvent(this,window,"touchmove",function(a){a.preventDefault()}),Crafty.stage.x=0,Crafty.stage.y=0}else d.position="relative",e=Crafty.DOM.inner(Crafty.stage.elem),Crafty.stage.x=e.x,Crafty.stage.y=e.y;Crafty.support.setter?(this.__defineSetter__("x",function(a){this.scroll("_x",a)}),this.__defineSetter__("y",function(a){this.scroll("_y",a)}),this.__defineGetter__("x",function(){return this._x}),this.__defineGetter__("y",function(){return this._y})):Crafty.support.defineProperty?(Object.defineProperty(this,"x",{set:function(a){this.scroll("_x",a)},get:function(){return this._x}}),Object.defineProperty(this,"y",{set:function(a){this.scroll("_y",a)},get:function(){return this._y}})):(this.x=this._x,this.y=this._y,Crafty.e("viewport"))},reload:function(){Crafty.DOM.window.init();var a=Crafty.DOM.window.width,b=Crafty.DOM.window.height,c;Crafty.stage.fullscreen&&(this.width=a,this.height=b,Crafty.stage.elem.style.width=a+"px",Crafty.stage.elem.style.height=b+"px",Crafty.canvas._canvas&&(Crafty.canvas._canvas.width=a,Crafty.canvas._canvas.height=b,Crafty.DrawManager.drawAll())),c=Crafty.DOM.inner(Crafty.stage.elem),Crafty.stage.x=c.x,Crafty.stage.y=c.y}},keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}}),Crafty.c("viewport",{init:function(){this.bind("EnterFrame",function(){Crafty.viewport._x!==Crafty.viewport.x&&Crafty.viewport.scroll("_x",Crafty.viewport.x),Crafty.viewport._y!==Crafty.viewport.y&&Crafty.viewport.scroll("_y",Crafty.viewport.y)})}}),Crafty.extend({device:{_deviceOrientationCallback:!1,_deviceMotionCallback:!1,_normalizeDeviceOrientation:function(a){var b;window.DeviceOrientationEvent?b={tiltLR:a.gamma,tiltFB:a.beta,dir:a.alpha,motUD:null}:window.OrientationEvent&&(b={tiltLR:a.x*90,tiltFB:a.y*-90,dir:null,motUD:a.z}),Crafty.device._deviceOrientationCallback(b)},_normalizeDeviceMotion:function(a){var b=a.accelerationIncludingGravity,c=b.z>0?1:-1,d={acceleration:b,rawAcceleration:"["+Math.round(b.x)+", "+Math.round(b.y)+", "+Math.round(b.z)+"]",facingUp:c,tiltLR:Math.round(b.x/9.81*-90),tiltFB:Math.round((b.y+9.81)/9.81*90*c)};Crafty.device._deviceMotionCallback(d)},deviceOrientation:function(a){this._deviceOrientationCallback=a,Crafty.support.deviceorientation&&(window.DeviceOrientationEvent?Crafty.addEvent(this,window,"deviceorientation",this._normalizeDeviceOrientation):window.OrientationEvent&&Crafty.addEvent(this,window,"MozOrientation",this._normalizeDeviceOrientation))},deviceMotion:function(a){this._deviceMotionCallback=a,Crafty.support.devicemotion&&window.DeviceMotionEvent&&Crafty.addEvent(this,window,"devicemotion",this._normalizeDeviceMotion)}}}),Crafty.c("Sprite",{__image:"",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:!1,init:function(){this.__trim=[0,0,0,0];var a=function(a){var b=a.co,c=a.pos,d=a.ctx;a.type==="canvas"?d.drawImage(this.img,b.x,b.y,b.w,b.h,c._x,c._y,c._w,c._h):a.type==="DOM"&&(this._element.style.background="url('"+this.__image+"') no-repeat -"+b.x+"px -"+b.y+"px")};this.bind("Draw",a).bind("RemoveComponent",function(b){b==="Sprite"&&this.unbind("Draw",a)})},sprite:function(a,b,c,d){return this.__coord=[a*this.__tile+this.__padding[0]+this.__trim[0],b*this.__tileh+this.__padding[1]+this.__trim[1],this.__trim[2]||c*this.__tile||this.__tile,this.__trim[3]||d*this.__tileh||this.__tileh],this.trigger("Change"),this},crop:function(a,b,c,d){var e=this._mbr||this.pos();return this.__trim=[],this.__trim[0]=a,this.__trim[1]=b,this.__trim[2]=c,this.__trim[3]=d,this.__coord[0]+=a,this.__coord[1]+=b,this.__coord[2]=c,this.__coord[3]=d,this._w=c,this._h=d,this.trigger("Change",e),this}}),Crafty.c("Canvas",{init:function(){Crafty.canvas.context||Crafty.canvas.init(),Crafty.DrawManager.total2D++,this.bind("Change",function(a){this._changed===!1?this._changed=Crafty.DrawManager.add(a||this,this):a&&(this._changed=Crafty.DrawManager.add(a,this))}),this.bind("Remove",function(){Crafty.DrawManager.total2D--,Crafty.DrawManager.add(this,this)})},draw:function(a,b,c,d,e){if(!this.ready)return;arguments.length===4&&(e=d,d=c,c=b,b=a,a=Crafty.canvas.context);var f={_x:this._x+(b||0),_y:this._y+(c||0),_w:d||this._w,_h:e||this._h},g=a||Crafty.canvas.context,h=this.__coord||[0,0,0,0],i={x:h[0]+(b||0),y:h[1]+(c||0),w:d||h[2],h:e||h[3]};this._mbr&&(g.save(),g.translate(this._origin.x+this._x,this._origin.y+this._y),f._x=-this._origin.x,f._y=-this._origin.y,g.rotate(this._rotation%360*(Math.PI/180)));if(this._flipX||this._flipY)g.save(),g.scale(this._flipX?-1:1,this._flipY?-1:1),this._flipX&&(f._x=-(f._x+f._w)),this._flipY&&(f._y=-(f._y+f._h));if(this._alpha<1){var j=g.globalAlpha;g.globalAlpha=this._alpha}return this.trigger("Draw",{type:"canvas",pos:f,co:i,ctx:g}),(this._mbr||this._flipX||this._flipY)&&g.restore(),j&&(g.globalAlpha=j),this}}),Crafty.extend({canvas:{context:null,init:function(){if(!Crafty.support.canvas){Crafty.trigger("NoCanvas"),Crafty.stop();return}var a;a=document.createElement("canvas"),a.width=Crafty.viewport.width,a.height=Crafty.viewport.height,a.style.position="absolute",a.style.left="0px",a.style.top="0px",Crafty.stage.elem.appendChild(a),Crafty.canvas.context=a.getContext("2d"),Crafty.canvas._canvas=a}}}),Crafty.extend({over:null,mouseObjs:0,mousePos:{},lastEvent:null,keydown:{},selected:!1,detectBlur:function(a){var b=a.clientX>Crafty.stage.x&&a.clientX<Crafty.stage.x+Crafty.viewport.width&&a.clientY>Crafty.stage.y&&a.clientY<Crafty.stage.y+Crafty.viewport.height;!Crafty.selected&&b&&Crafty.trigger("CraftyFocus"),Crafty.selected&&!b&&Crafty.trigger("CraftyBlur"),Crafty.selected=b},mouseDispatch:function(a){if(!Crafty.mouseObjs)return;Crafty.lastEvent=a;var b=-1,c,d,e=0,f,g=Crafty.DOM.translate(a.clientX,a.clientY),h,i,j={},k=a.target?a.target:a.srcElement,l=a.type;a.which==null?a.mouseButton=a.button<2?Crafty.mouseButtons.LEFT:a.button==4?Crafty.mouseButtons.MIDDLE:Crafty.mouseButtons.RIGHT:a.mouseButton=a.which<2?Crafty.mouseButtons.LEFT:a.which==2?Crafty.mouseButtons.MIDDLE:Crafty.mouseButtons.RIGHT,a.realX=h=Crafty.mousePos.x=g.x,a.realY=i=Crafty.mousePos.y=g.y;if(k.nodeName!="CANVAS"){while(typeof k.id!="string"&&k.id.indexOf("ent")==-1)k=k.parentNode;ent=Crafty(parseInt(k.id.replace("ent",""))),ent.has("Mouse")&&ent.isAt(h,i)&&(c=ent)}if(!c){d=Crafty.map.search({_x:h,_y:i,_w:1,_h:1},!1);for(f=d.length;e<f;++e){if(!d[e].__c.Mouse||!d[e]._visible)continue;var m=d[e],n=!1;if(j[m[0]])continue;j[m[0]]=!0,m.mapArea?m.mapArea.containsPoint(h,i)&&(n=!0):m.isAt(h,i)&&(n=!0);if(n&&(m._z>=b||b===-1)){if(m._z===b&&m[0]<c[0])continue;b=m._z,c=m}}}c?l==="mousedown"?c.trigger("MouseDown",a):l==="mouseup"?c.trigger("MouseUp",a):l=="dblclick"?c.trigger("DoubleClick",a):l=="click"?c.trigger("Click",a):l==="mousemove"?(c.trigger("MouseMove",a),this.over!==c&&(this.over&&(this.over.trigger("MouseOut",a),this.over=null),this.over=c,c.trigger("MouseOver",a))):c.trigger(l,a):(l==="mousemove"&&this.over&&(this.over.trigger("MouseOut",a),this.over=null),l==="mousedown"?Crafty.viewport.mouselook("start",a):l==="mousemove"?Crafty.viewport.mouselook("drag",a):l=="mouseup"&&Crafty.viewport.mouselook("stop")),l==="mousemove"&&(this.lastEvent=a)},touchDispatch:function(a){var b;a.type==="touchstart"?b="mousedown":a.type==="touchmove"?b="mousemove":a.type==="touchend"?b="mouseup":a.type==="touchcancel"?b="mouseup":a.type==="touchleave"&&(b="mouseup"),a.touches&&a.touches.length?first=a.touches[0]:a.changedTouches&&a.changedTouches.length&&(first=a.changedTouches[0]);var c=document.createEvent("MouseEvent");c.initMouseEvent(b,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,a.relatedTarget),first.target.dispatchEvent(c)},keyboardDispatch:function(a){a.key=a.keyCode||a.which,a.type==="keydown"?Crafty.keydown[a.key]!==!0&&(Crafty.keydown[a.key]=!0,Crafty.trigger("KeyDown",a)):a.type==="keyup"&&(delete Crafty.keydown[a.key],Crafty.trigger("KeyUp",a));if(Crafty.selected&&!(a.key==8||a.key>=112&&a.key<=135))return a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1,!1}}),Crafty.bind("Load",function(){Crafty.addEvent(this,"keydown",Crafty.keyboardDispatch),Crafty.addEvent(this,"keyup",Crafty.keyboardDispatch),Crafty.addEvent(this,Crafty.stage.elem,"mousedown",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"mouseup",Crafty.mouseDispatch),Crafty.addEvent(this,document.body,"mouseup",Crafty.detectBlur),Crafty.addEvent(this,Crafty.stage.elem,"mousemove",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"click",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"dblclick",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchstart",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchmove",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchend",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchcancel",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchleave",Crafty.touchDispatch)}),Crafty.c("Mouse",{init:function(){Crafty.mouseObjs++,this.bind("Remove",function(){Crafty.mouseObjs--})},areaMap:function(a){if(arguments.length>1){var b=Array.prototype.slice.call(arguments,0);a=new Crafty.polygon(b)}return a.shift(this._x,this._y),this.mapArea=a,this.attach(this.mapArea),this}}),Crafty.c("Draggable",{_origMouseDOMPos:null,_oldX:null,_oldY:null,_dragging:!1,_dir:null,_ondrag:null,_ondown:null,_onup:null,init:function(){this.requires("Mouse"),this._ondrag=function(a){var b=Crafty.DOM.translate(a.clientX,a.clientY);if(b.x==0||b.y==0)return!1;if(this._dir){var c=(b.x-this._origMouseDOMPos.x)*this._dir.x+(b.y-this._origMouseDOMPos.y)*this._dir.y;this.x=this._oldX+c*this._dir.x,this.y=this._oldY+c*this._dir.y}else this.x=this._oldX+(b.x-this._origMouseDOMPos.x),this.y=this._oldY+(b.y-this._origMouseDOMPos.y);this.trigger("Dragging",a)},this._ondown=function(a){if(a.mouseButton!==Crafty.mouseButtons.LEFT)return;this._origMouseDOMPos=Crafty.DOM.translate(a.clientX,a.clientY),this._oldX=this._x,this._oldY=this._y,this._dragging=!0,Crafty.addEvent(this,Crafty.stage.elem,"mousemove",this._ondrag),Crafty.addEvent(this,Crafty.stage.elem,"mouseup",this._onup),this.trigger("StartDrag",a)},this._onup=function(b){this._dragging==1&&(Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",this._ondrag),Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag",b))},this.enableDrag()},dragDirection:function(a){if(typeof a=="undefined")this._dir=null;else if(""+parseInt(a)==a)this._dir={x:Math.cos(a/180*Math.PI),y:Math.sin(a/180*Math.PI)};else{var b=Math.sqrt(a.x*a.x+a.y*a.y);this._dir={x:a.x/b,y:a.y/b}}},stopDrag:function(){return Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",this._ondrag),Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag"),this},startDrag:function(){return this._dragging||(this._dragging=!0,Crafty.addEvent(this,Crafty.stage.elem,"mousemove",this._ondrag)),this},enableDrag:function(){return this.bind("MouseDown",this._ondown),Crafty.addEvent(this,Crafty.stage.elem,"mouseup",this._onup),this},disableDrag:function(){return this.unbind("MouseDown",this._ondown),this.stopDrag(),this}}),Crafty.c("Keyboard",{isDown:function(a){return typeof a=="string"&&(a=Crafty.keys[a]),!!Crafty.keydown[a]}}),Crafty.c("Multiway",{_speed:3,_keydown:function(a){this._keys[a.key]&&(this._movement.x=Math.round((this._movement.x+this._keys[a.key].x)*1e3)/1e3,this._movement.y=Math.round((this._movement.y+this._keys[a.key].y)*1e3)/1e3,this.trigger("NewDirection",this._movement))},_keyup:function(a){this._keys[a.key]&&(this._movement.x=Math.round((this._movement.x-this._keys[a.key].x)*1e3)/1e3,this._movement.y=Math.round((this._movement.y-this._keys[a.key].y)*1e3)/1e3,this.trigger("NewDirection",this._movement))},_enterframe:function(){if(this.disableControls)return;this._movement.x!==0&&(this.x+=this._movement.x,this.trigger("Moved",{x:this.x-this._movement.x,y:this.y})),this._movement.y!==0&&(this.y+=this._movement.y,this.trigger("Moved",{x:this.x,y:this.y-this._movement.y}))},init:function(){this._keyDirection={},this._keys={},this._movement={x:0,y:0},this._speed={x:3,y:3}},multiway:function(a,b){b?a.x&&a.y?(this._speed.x=a.x,this._speed.y=a.y):(this._speed.x=a,this._speed.y=a):b=a,this._keyDirection=b,this.speed(this._speed),this.enableControl();for(var c in b)Crafty.keydown[Crafty.keys[c]]&&this.trigger("KeyDown",{key:Crafty.keys[c]});return this},enableControl:function(){return this.bind("KeyDown",this._keydown).bind("KeyUp",this._keyup).bind("EnterFrame",this._enterframe),this},disableControl:function(){return this.unbind("KeyDown",this._keydown).unbind("KeyUp",this._keyup).unbind("EnterFrame",this._enterframe),this},speed:function(a){for(var b in this._keyDirection){var c=Crafty.keys[b]||b;this._keys[c]={x:Math.round(Math.cos(this._keyDirection[b]*(Math.PI/180))*1e3*a.x)/1e3,y:Math.round(Math.sin(this._keyDirection[b]*(Math.PI/180))*1e3*a.y)/1e3}}return this}}),Crafty.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(a){return this.multiway(a,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180,Z:-90,Q:180}),this}}),Crafty.c("Twoway",{_speed:3,_up:!1,init:function(){this.requires("Fourway, Keyboard")},twoway:function(a,b){return this.multiway(a,{RIGHT_ARROW:0,LEFT_ARROW:180,D:0,A:180,Q:180}),a&&(this._speed=a),b=b||this._speed*2,this.bind("EnterFrame",function(){if(this.disableControls)return;this._up&&(this.y-=b,this._falling=!0)}).bind("KeyDown",function(){if(this.isDown("UP_ARROW")||this.isDown("W")||this.isDown("Z"))this._up=!0}),this}}),Crafty.c("SpriteAnimation",{_reels:null,_frame:null,_currentReelId:null,init:function(){this._reels={}},animate:function(a,b,c,d){var e,f,g,h,i,j;if(arguments.length<4&&typeof b=="number")return i=b,this._currentReelId=a,currentReel=this._reels[a],this._frame={currentReel:currentReel,numberOfFramesBetweenSlides:Math.ceil(i/currentReel.length),currentSlideNumber:0,frameNumberBetweenSlides:0,repeat:0},arguments.length===3&&typeof c=="number"&&(c===-1?this._frame.repeatInfinitly=!0:this._frame.repeat=c),j=this._frame.currentReel[0],this.__coord[0]=j[0],this.__coord[1]=j[1],this.bind("EnterFrame",this.updateSprite),this;if(typeof b=="number"){g=this.__tile+parseInt(this.__padding[0]||0,10),h=this.__tileh+parseInt(this.__padding[1]||0,10),e=[],f=b;if(d>b)for(;f<=d;f++)e.push([f*g,c*h]);else for(;f>=d;f--)e.push([f*g,c*h]);this._reels[a]=e}else if(typeof b=="object"){f=0,e=[],d=b.length-1,g=this.__tile+parseInt(this.__padding[0]||0,10),h=this.__tileh+parseInt(this.__padding[1]||0,10);for(;f<=d;f++)j=b[f],e.push([j[0]*g,j[1]*h]);this._reels[a]=e}return this},updateSprite:function(){var a=this._frame;if(!a)return;if(this._frame.frameNumberBetweenSlides++===a.numberOfFramesBetweenSlides){var b=a.currentReel[a.currentSlideNumber++];this.__coord[0]=b[0],this.__coord[1]=b[1],this._frame.frameNumberBetweenSlides=0}if(a.currentSlideNumber===a.currentReel.length)if(this._frame.repeatInfinitly===!0||this._frame.repeat>0)this._frame.repeat&&this._frame.repeat--,this._frame.frameNumberBetweenSlides=0,this._frame.currentSlideNumber=0;else if(this._frame.frameNumberBetweenSlides===a.numberOfFramesBetweenSlides){this.trigger("AnimationEnd",{reel:a.currentReel}),this.stop();return}this.trigger("Change")},stop:function(){return this.unbind("EnterFrame",this.updateSprite),this.unbind("AnimationEnd"),this._currentReelId=null,this._frame=null,this},reset:function(){if(!this._frame)return this;var a=this._frame.currentReel[0];return this.__coord[0]=a[0],this.__coord[1]=a[1],this.stop(),this},isPlaying:function(a){return a?this._currentReelId===a:!!this._interval}}),Crafty.c("Tween",{_step:null,_numProps:0,tween:function(a,b){return this.each(function(){this._step==null&&(this._step={},this.bind("EnterFrame",tweenEnterFrame),this.bind("RemoveComponent",function(a){a=="Tween"&&this.unbind("EnterFrame",tweenEnterFrame)}));for(var c in a)this._step[c]={prop:a[c],val:(a[c]-this[c])/b,rem:b},this._numProps++}),this}}),Crafty.c("Color",{_color:"",ready:!0,init:function(){this.bind("Draw",function(a){a.type==="DOM"?(a.style.background=this._color,a.style.lineHeight=0):a.type==="canvas"&&(this._color&&(a.ctx.fillStyle=this._color),a.ctx.fillRect(a.pos._x,a.pos._y,a.pos._w,a.pos._h))})},color:function(a){return a?(this._color=a,this.trigger("Change"),this):this._color}}),Crafty.c("Tint",{_color:null,_strength:1,init:function(){var a=function(b){var c=b.ctx||Crafty.canvas.context;c.fillStyle=this._color||"rgb(0,0,0)",c.fillRect(b.pos._x,b.pos._y,b.pos._w,b.pos._h)};this.bind("Draw",a).bind("RemoveComponent",function(b){b==="Tint"&&this.unbind("Draw",a)})},tint:function(a,b){return this._strength=b,this._color=Crafty.toRGB(a,this._strength),this.trigger("Change"),this}}),Crafty.c("Image",{_repeat:"repeat",ready:!1,init:function(){var a=function(a){if(a.type==="canvas"){if(!this.ready||!this._pattern)return;var b=a.ctx;b.fillStyle=this._pattern,b.save(),b.translate(a.pos._x,a.pos._y),b.fillRect(0,0,this._w,this._h),b.restore()}else a.type==="DOM"&&this.__image&&(a.style.background="url("+this.__image+") "+this._repeat)};this.bind("Draw",a).bind("RemoveComponent",function(b){b==="Image"&&this.unbind("Draw",a)})},image:function(a,b){this.__image=a,this._repeat=b||"no-repeat",this.img=Crafty.asset(a);if(!this.img){this.img=new Image,Crafty.asset(a,this.img),this.img.src=a;var c=this;return this.img.onload=function(){c.has("Canvas")&&(c._pattern=Crafty.canvas.context.createPattern(c.img,c._repeat)),c.ready=!0,c._repeat==="no-repeat"&&(c.w=c.img.width,c.h=c.img.height),c.trigger("Change")},this}return this.ready=!0,this.has("Canvas")&&(this._pattern=Crafty.canvas.context.createPattern(this.img,this._repeat)),this._repeat==="no-repeat"&&(this.w=this.img.width,this.h=this.img.height),this.trigger("Change"),this}}),Crafty.extend({_scenes:[],_current:null,scene:function(a,b,c){if(arguments.length===1){Crafty("2D").each(function(){this.has("Persist")||this.destroy()}),this._current!==null&&"uninitialize"in this._scenes[this._current]&&this._scenes[this._current].uninitialize.call(this),this._scenes[a].initialize.call(this);var d=this._current;this._current=a,Crafty.trigger("SceneChange",{oldScene:d,newScene:a});return}this._scenes[a]={},this._scenes[a].initialize=b,typeof c!="undefined"&&(this._scenes[a].uninitialize=c);return},toRGB:function(a,b){var a=a.charAt(0)==="#"?a.substr(1):a,c=[],d;return c[0]=parseInt(a.substr(0,2),16),c[1]=parseInt(a.substr(2,2),16),c[2]=parseInt(a.substr(4,2),16),d=b===undefined?"rgb("+c.join(",")+")":"rgba("+c.join(",")+","+b+")",d}}),Crafty.DrawManager=function(){var a=[],b=[];return{total2D:Crafty("2D").length,onScreen:function(a){return Crafty.viewport._x+a._x+a._w>0&&Crafty.viewport._y+a._y+a._h>0&&Crafty.viewport._x+a._x<Crafty.viewport.width&&Crafty.viewport._y+a._y<Crafty.viewport.height},merge:function(a){do{var b=[],c=!1,d=0,e=a.length,f,g,h;while(d<e)f=a[d],g=a[d+1],d<e-1&&f._x<g._x+g._w&&f._x+f._w>g._x&&f._y<g._y+g._h&&f._h+f._y>g._y?(h={_x:~~Math.min(f._x,g._x),_y:~~Math.min(f._y,g._y),_w:Math.max(f._x,g._x)+Math.max(f._w,g._w),_h:Math.max(f._y,g._y)+Math.max(f._h,g._h)},h._w=h._w-h._x,h._h=h._h-h._y,h._w=h._w==~~h._w?h._w:h._w+1|0,h._h=h._h==~~h._h?h._h:h._h+1|0,b.push(h),d++,c=!0):b.push(f),d++;a=b.length?Crafty.clone(b):a,c&&(d=0)}while(c);return a},add:function(d,e){if(!e){b.push(d);return}var f,g=d._mbr||d,
h=e._mbr||e;return d===e?f=d.mbr()||d.pos():(f={_x:~~Math.min(g._x,h._x),_y:~~Math.min(g._y,h._y),_w:Math.max(g._w,h._w)+Math.max(g._x,h._x),_h:Math.max(g._h,h._h)+Math.max(g._y,h._y)},f._w=f._w-f._x,f._h=f._h-f._y),f._w===0||f._h===0||!this.onScreen(f)?!1:(f._x=~~f._x,f._y=~~f._y,f._w=f._w===~~f._w?f._w:f._w+1|0,f._h=f._h===~~f._h?f._h:f._h+1|0,a.push(f),!0)},debug:function(){console.log(a,b)},drawAll:function(a){var a=a||Crafty.viewport.rect(),b=Crafty.map.search(a),c=0,d=b.length,e=Crafty.canvas.context,f;e.clearRect(a._x,a._y,a._w,a._h),b.sort(function(a,b){return a._globalZ-b._globalZ});for(;c<d;c++)f=b[c],f._visible&&f.__c.Canvas&&(f.draw(),f._changed=!1)},boundingRect:function(a){if(!a||!a.length)return;var b=[],c=1,d=a.length,e,f=a[0],g;f=[f._x,f._y,f._x+f._w,f._y+f._h];while(c<d)e=a[c],g=[e._x,e._y,e._x+e._w,e._y+e._h],g[0]<f[0]&&(f[0]=g[0]),g[1]<f[1]&&(f[1]=g[1]),g[2]>f[2]&&(f[2]=g[2]),g[3]>f[3]&&(f[3]=g[3]),c++;return g=f,f={_x:g[0],_y:g[1],_w:g[2]-g[0],_h:g[3]-g[1]},f},draw:function(){if(!a.length&&!b.length)return;var d=0,e=a.length,f=b.length,g,h,i,j,k,l,m,n=[],o=Crafty.canvas.context;for(;d<f;++d)b[d].draw()._changed=!1;b.length=0;if(!e)return;if(e/this.total2D>.6){this.drawAll(),a.length=0;return}a=this.merge(a);for(d=0;d<e;++d){g=a[d];if(!g)continue;h=Crafty.map.search(g,!1),k={};for(i=0,j=h.length;i<j;++i){l=h[i];if(k[l[0]]||!l._visible||!l.__c.Canvas)continue;k[l[0]]=!0,n.push({obj:l,rect:g})}o.clearRect(g._x,g._y,g._w,g._h)}n.sort(function(a,b){return a.obj._globalZ-b.obj._globalZ});if(!n.length)return;for(d=0,e=n.length;d<e;++d){l=n[d],g=l.rect,m=l.obj;var p=m._mbr||m,q=g._x-p._x<=0?0:~~(g._x-p._x),r=g._y-p._y<0?0:~~(g._y-p._y),s=~~Math.min(p._w-q,g._w-(p._x-g._x),g._w,p._w),t=~~Math.min(p._h-r,g._h-(p._y-g._y),g._h,p._h);if(t===0||s===0)continue;o.save(),o.beginPath(),o.moveTo(g._x,g._y),o.lineTo(g._x+g._w,g._y),o.lineTo(g._x+g._w,g._h+g._y),o.lineTo(g._x,g._h+g._y),o.lineTo(g._x,g._y),o.clip(),m.draw(),o.closePath(),o.restore(),m._changed=!1}a.length=0,merged={}}}}(),Crafty.extend({isometric:{_tile:{width:0,height:0},_elements:{},_pos:{x:0,y:0},_z:0,size:function(a,b){return this._tile.width=a,this._tile.height=b>0?b:a/2,this},place:function(a,b,c,d){var e=this.pos2px(a,b);return e.top-=c*(this._tile.width/2),d.attr({x:e.left+Crafty.viewport._x,y:e.top+Crafty.viewport._y}).z+=c,this},pos2px:function(a,b){return{left:a*this._tile.width+(b&1)*(this._tile.width/2),top:b*this._tile.height/2}},px2pos:function(a,b){return{x:Math.ceil(-a/this._tile.width-(b&1)*.5),y:-b/this._tile.height*2}},centerAt:function(a,b){if(typeof a=="number"&&typeof b=="number"){var c=this.pos2px(a,b);return Crafty.viewport._x=-c.left+Crafty.viewport.width/2-this._tile.width/2,Crafty.viewport._y=-c.top+Crafty.viewport.height/2-this._tile.height/2,this}return{top:-Crafty.viewport._y+Crafty.viewport.height/2-this._tile.height/2,left:-Crafty.viewport._x+Crafty.viewport.width/2-this._tile.width/2}},area:function(){var a=this.centerAt(),b=this.px2pos(-a.left+Crafty.viewport.width/2,-a.top+Crafty.viewport.height/2),c=this.px2pos(-a.left-Crafty.viewport.width/2,-a.top-Crafty.viewport.height/2);return{x:{start:b.x,end:c.x},y:{start:b.y,end:c.y}}}}}),Crafty.c("Particles",{init:function(){this._Particles=Crafty.clone(this._Particles)},particles:function(a){if(!Crafty.support.canvas||Crafty.deactivateParticles)return this;var b,c,d,e,f;b=document.createElement("canvas"),b.width=Crafty.viewport.width,b.height=Crafty.viewport.height,b.style.position="absolute",Crafty.stage.elem.appendChild(b),c=b.getContext("2d"),this._Particles.init(a),this.bind("Remove",function(){Crafty.stage.elem.removeChild(b)}).bind("RemoveComponent",function(a){a==="particles"&&Crafty.stage.elem.removeChild(b)}),d=this.x+Crafty.viewport.x,e=this.y+Crafty.viewport.y,this._Particles.position=this._Particles.vectorHelpers.create(d,e);var g={x:Crafty.viewport.x,y:Crafty.viewport.y};return this.bind("EnterFrame",function(){d=this.x+Crafty.viewport.x,e=this.y+Crafty.viewport.y,this._Particles.viewportDelta={x:Crafty.viewport.x-g.x,y:Crafty.viewport.y-g.y},g={x:Crafty.viewport.x,y:Crafty.viewport.y},this._Particles.position=this._Particles.vectorHelpers.create(d,e),typeof Crafty.DrawManager.boundingRect=="function"?(f=Crafty.DrawManager.boundingRect(this._Particles.register),f&&c.clearRect(f._x,f._y,f._w,f._h)):c.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),this._Particles.update(),this._Particles.render(c)}),this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:!1,gravity:{x:0,y:.1},jitter:0,particles:[],active:!0,particleCount:0,elapsedFrames:0,emissionRate:0,emitCounter:0,particleIndex:0},init:function(a){this.position=this.vectorHelpers.create(0,0);if(typeof a=="undefined")var a={};for(key in this.presets)typeof a[key]!="undefined"?this[key]=a[key]:this[key]=this.presets[key];this.emissionRate=this.maxParticles/this.lifeSpan,this.positionRandom=this.vectorHelpers.create(this.spread,this.spread)},addParticle:function(){if(this.particleCount==this.maxParticles)return!1;var a=new this.particle(this.vectorHelpers);return this.initParticle(a),this.particles[this.particleCount]=a,this.particleCount++,!0},RANDM1TO1:function(){return Math.random()*2-1},initParticle:function(a){a.position.x=this.position.x+this.positionRandom.x*this.RANDM1TO1(),a.position.y=this.position.y+this.positionRandom.y*this.RANDM1TO1();var b=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180),c=this.vectorHelpers.create(Math.sin(b),-Math.cos(b)),d=this.speed+this.speedRandom*this.RANDM1TO1();a.direction=this.vectorHelpers.multiply(c,d),a.size=this.size+this.sizeRandom*this.RANDM1TO1(),a.size=a.size<0?0:~~a.size,a.timeToLive=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1(),a.sharpness=this.sharpness+this.sharpnessRandom*this.RANDM1TO1(),a.sharpness=a.sharpness>100?100:a.sharpness<0?0:a.sharpness,a.sizeSmall=~~(a.size/200*a.sharpness);var e=[this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1()],f=[this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),this.endColour[3]+this.endColourRandom[3]*this.RANDM1TO1()];a.colour=e,a.deltaColour[0]=(f[0]-e[0])/a.timeToLive,a.deltaColour[1]=(f[1]-e[1])/a.timeToLive,a.deltaColour[2]=(f[2]-e[2])/a.timeToLive,a.deltaColour[3]=(f[3]-e[3])/a.timeToLive},update:function(){if(this.active&&this.emissionRate>0){var a=1/this.emissionRate;this.emitCounter++;while(this.particleCount<this.maxParticles&&this.emitCounter>a)this.addParticle(),this.emitCounter-=a;this.elapsedFrames++,this.duration!=-1&&this.duration<this.elapsedFrames&&this.stop()}this.particleIndex=0,this.register=[];var b;while(this.particleIndex<this.particleCount){var c=this.particles[this.particleIndex];if(c.timeToLive>0){c.direction=this.vectorHelpers.add(c.direction,this.gravity),c.position=this.vectorHelpers.add(c.position,c.direction),c.position=this.vectorHelpers.add(c.position,this.viewportDelta),this.jitter&&(c.position.x+=this.jitter*this.RANDM1TO1(),c.position.y+=this.jitter*this.RANDM1TO1()),c.timeToLive--;var d=c.colour[0]+=c.deltaColour[0],e=c.colour[1]+=c.deltaColour[1],f=c.colour[2]+=c.deltaColour[2],g=c.colour[3]+=c.deltaColour[3];b=[],b.push("rgba("+(d>255?255:d<0?0:~~d)),b.push(e>255?255:e<0?0:~~e),b.push(f>255?255:f<0?0:~~f),b.push((g>1?1:g<0?0:g.toFixed(2))+")"),c.drawColour=b.join(","),this.fastMode||(b[3]="0)",c.drawColourEnd=b.join(",")),this.particleIndex++}else this.particleIndex!=this.particleCount-1&&(this.particles[this.particleIndex]=this.particles[this.particleCount-1]),this.particleCount--;var h={};h._x=~~c.position.x,h._y=~~c.position.y,h._w=c.size,h._h=c.size,this.register.push(h)}},stop:function(){this.active=!1,this.elapsedFrames=0,this.emitCounter=0},render:function(a){for(var b=0,c=this.particleCount;b<c;b++){var d=this.particles[b],e=d.size,f=e>>1;if(d.position.x+e<0||d.position.y+e<0||d.position.x-e>Crafty.viewport.width||d.position.y-e>Crafty.viewport.height)continue;var g=~~d.position.x,h=~~d.position.y;if(this.fastMode)a.fillStyle=d.drawColour;else{var i=a.createRadialGradient(g+f,h+f,d.sizeSmall,g+f,h+f,f);i.addColorStop(0,d.drawColour),i.addColorStop(.9,d.drawColourEnd),a.fillStyle=i}a.fillRect(g,h,e,e)}},particle:function(a){this.position=a.create(0,0),this.direction=a.create(0,0),this.size=0,this.sizeSmall=0,this.timeToLive=0,this.colour=[],this.drawColour="",this.deltaColour=[],this.sharpness=0},vectorHelpers:{create:function(a,b){return{x:a,y:b}},multiply:function(a,b){return a.x*=b,a.y*=b,a},add:function(a,b){return a.x+=b.x,a.y+=b.y,a}}}}),Crafty.extend({audio:{sounds:{},supported:{},codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:!1,canPlay:function(){var a=this.audioElement(),b;for(var c in this.codecs)b=a.canPlayType(this.codecs[c]),b!==""&&b!=="no"?this.supported[c]=!0:this.supported[c]=!1},audioElement:function(){return typeof Audio!="undefined"?new Audio(""):document.createElement("audio")},add:function(a,b){Crafty.support.audio=!!this.audioElement().canPlayType;if(!Crafty.support.audio)return;this.canPlay();var c,d,e;if(arguments.length===1&&typeof a=="object")for(var f in a)for(var g in a[f])c=this.audioElement(),c.id=f,c.preload="auto",c.volume=Crafty.audio.volume,e=a[f][g],d=e.substr(e.lastIndexOf(".")+1).toLowerCase(),this.supported[d]&&(c.src=e,Crafty.asset(e,c),this.sounds[f]={obj:c,played:0});if(typeof a=="string"){c=this.audioElement(),c.id=a,c.preload="auto",c.volume=Crafty.audio.volume,typeof b=="string"&&(d=b.substr(b.lastIndexOf(".")+1).toLowerCase(),this.supported[d]&&(c.src=b,Crafty.asset(b,c),this.sounds[a]={obj:c,played:0}));if(typeof b=="object")for(g in b)c=this.audioElement(),c.id=a,c.preload="auto",c.volume=Crafty.audio.volume,e=b[g],d=e.substr(e.lastIndexOf(".")+1).toLowerCase(),this.supported[d]&&(c.src=e,Crafty.asset(e,c),this.sounds[a]={obj:c,played:0})}},play:function(a,b,c){if(b==0||!Crafty.support.audio||!this.sounds[a])return;var d=this.sounds[a];d.obj.volume=c||Crafty.audio.volume,d.obj.currentTime&&(d.obj.currentTime=0),d.obj.play(),d.played++,d.obj.addEventListener("ended",function(){if(d.played<b||b==-1)this.currentTime&&(this.currentTime=0),this.play(),d.played++},!0)},stop:function(a){if(!Crafty.support.audio)return;var b;if(!a)for(var c in this.sounds)b=this.sounds[c],b.obj.paused||b.obj.pause();if(!this.sounds[a])return;b=this.sounds[a],b.obj.paused||b.obj.pause()},mute:function(){if(!Crafty.support.audio)return;var a;if(!this.muted){for(var b in this.sounds)a=this.sounds[b],a.obj.pause();this.muted=!0}else{for(var b in this.sounds)a=this.sounds[b],a.obj.currentTime&&a.obj.currentTime>0&&this.sounds[b].obj.play();this.muted=!1}}}}),Crafty.c("Text",{_text:"",_textFont:{type:"",weight:"",size:"",family:""},ready:!0,init:function(){this.requires("2D"),this.bind("Draw",function(a){var b=this._textFont.type+" "+this._textFont.weight+" "+this._textFont.size+" "+this._textFont.family;if(a.type==="DOM"){var c=this._element,d=c.style;d.color=this._textColor,d.font=b,c.innerHTML=this._text}else if(a.type==="canvas"){var e=a.ctx,f=null;e.save(),e.fillStyle=this._textColor||"rgb(0,0,0)",e.font=b,e.translate(this.x,this.y+this.h),e.fillText(this._text,0,0),f=e.measureText(this._text),this._w=f.width,e.restore()}})},text:function(a){return a?(typeof a=="function"?this._text=a.call(this):this._text=a,this.trigger("Change"),this):this._text},textColor:function(a,b){return this._strength=b,this._textColor=Crafty.toRGB(a,this._strength),this.trigger("Change"),this},textFont:function(a,b){if(arguments.length===1){if(typeof a=="string")return this._textFont[a];if(typeof a=="object")for(propertyKey in a)this._textFont[propertyKey]=a[propertyKey]}else this._textFont[a]=b;return this.trigger("Change"),this}}),Crafty.extend({assets:{},asset:function(a,b){if(arguments.length===1)return Crafty.assets[a];Crafty.assets[a]||(Crafty.assets[a]=b,this.trigger("NewAsset",{key:a,value:b}))},load:function(a,b,c,d){function l(){var a=this.src;this.removeEventListener&&this.removeEventListener("canplaythrough",l,!1),++j,c&&c({loaded:j,total:i,percent:j/i*100,src:a}),j===i&&b&&b()}function m(){var a=this.src;d&&d({loaded:j,total:i,percent:j/i*100,src:a}),j++,j===i&&b&&b()}var e=0,f=a.length,g,h,i=f,j=0,k="";for(;e<f;++e){g=a[e],k=g.substr(g.lastIndexOf(".")+1).toLowerCase(),h=Crafty.asset(g)||null;if(Crafty.support.audio&&Crafty.audio.supported[k]){if(!h){var n=g.substr(g.lastIndexOf("/")+1).toLowerCase();h=Crafty.audio.audioElement(),h.id=n,h.src=g,h.preload="auto",h.volume=Crafty.audio.volume,Crafty.asset(g,h),Crafty.audio.sounds[n]={obj:h,played:0}}h.addEventListener&&h.addEventListener("canplaythrough",l,!1)}else{if(k!=="jpg"&&k!=="jpeg"&&k!=="gif"&&k!=="png"){i--;continue}h||(h=new Image,Crafty.asset(g,h)),h.onload=l,h.src=g}h.onerror=m}},modules:function(a,b,c){arguments.length===2&&typeof a=="object"&&(c=b,b=a,a="http://cdn.craftycomponents.com");var d=function(){function s(a,b,c){for(c=0,j=a.length;c<j;++c)if(!b(a[c]))return m;return 1}function t(a,b){s(a,function(a){return!b(a)})}function u(a,b,c){function o(a){return a.call?a():f[a]}function p(){if(!--m){f[l]=1,j&&j();for(var a in h)s(a.split("|"),o)&&!t(h[a],o)&&(h[a]=[])}}a=a[n]?a:[a];var e=b&&b.call,j=e?b:c,l=e?a.join(""):b,m=a.length;return setTimeout(function(){t(a,function(a){if(k[a])return l&&(g[l]=1),k[a]==2&&p();k[a]=1,l&&(g[l]=1),v(!d.test(a)&&i?i+a+".js":a,p)})},0),u}function v(a,d){var e=b.createElement("script"),f=m;e.onload=e.onerror=e[r]=function(){if(e[p]&&!/^c|loade/.test(e[p])||f)return;e.onload=e[r]=null,f=1,k[a]=2,d()},e.async=1,e.src=a,c.insertBefore(e,c.firstChild)}var a=this,b=document,c=b.getElementsByTagName("head")[0],d=/^https?:\/\//,e=a.$script,f={},g={},h={},i,k={},l="string",m=!1,n="push",o="DOMContentLoaded",p="readyState",q="addEventListener",r="onreadystatechange";return!b[p]&&b[q]&&(b[q](o,function w(){b.removeEventListener(o,w,m),b[p]="complete"},m),b[p]="loading"),u.get=v,u.order=function(a,b,c){(function d(e){e=a.shift(),a.length?u(e,d):u(e,b,c)})()},u.path=function(a){i=a},u.ready=function(a,b,c){a=a[n]?a:[a];var d=[];return!t(a,function(a){f[a]||d[n](a)})&&s(a,function(a){return f[a]})?b():!function(a){h[a]=h[a]||[],h[a][n](b),c&&c(d)}(a.join("|")),u},u.noConflict=function(){return a.$script=e,this},u}(),e=[],f=/^(https?|file):\/\//;for(var g in b)f.test(g)?e.push(g):e.push(a+"/"+g.toLowerCase()+"-"+b[g].toLowerCase()+".js");d(e,function(){c&&c()})}}),Crafty.math={abs:function(a){return a<0?-a:a},amountOf:function(a,b,c){return b<c?(a-b)/(c-b):(a-c)/(b-c)},clamp:function(a,b,c){return a>c?c:a<b?b:a},degToRad:function(a){return a*Math.PI/180},distance:function(a,b,c,d){var e=Crafty.math.squaredDistance(a,b,c,d);return Math.sqrt(parseFloat(e))},lerp:function(a,b,c){return a+(b-a)*c},negate:function(a){return Math.random()<a?-1:1},radToDeg:function(a){return a*180/Math.PI},randomElementOfArray:function(a){return a[Math.floor(a.length*Math.random())]},randomInt:function(a,b){return a+Math.floor((1+b-a)*Math.random())},randomNumber:function(a,b){return a+(b-a)*Math.random()},squaredDistance:function(a,b,c,d){return(a-c)*(a-c)+(b-d)*(b-d)},withinRange:function(a,b,c){return a>=b&&a<=c}},Crafty.math.Vector2D=function(){function a(b,c){if(b instanceof a)this.x=b.x,this.y=b.y;else if(arguments.length===2)this.x=b,this.y=c;else if(arguments.length>0)throw"Unexpected number of arguments for Vector2D()"}return a.prototype.x=0,a.prototype.y=0,a.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},a.prototype.angleBetween=function(a){return Math.atan2(this.x*a.y-this.y*a.x,this.x*a.x+this.y*a.y)},a.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},a.prototype.clone=function(){return new a(this)},a.prototype.distance=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))},a.prototype.distanceSq=function(a){return(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)},a.prototype.divide=function(a){return this.x/=a.x,this.y/=a.y,this},a.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y},a.prototype.equals=function(b){return b instanceof a&&this.x==b.x&&this.y==b.y},a.prototype.getNormal=function(b){return b===undefined?new a(-this.y,this.x):(new a(b.y-this.y,this.x-b.x)).normalize()},a.prototype.isZero=function(){return this.x===0&&this.y===0},a.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.magnitudeSq=function(){return this.x*this.x+this.y*this.y},a.prototype.multiply=function(a){return this.x*=a.x,this.y*=a.y,this},a.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},a.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);return a===0?(this.x=1,this.y=0):(this.x/=a,this.y/=a),this},a.prototype.scale=function(a,b){return b===undefined&&(b=a),this.x*=a,this.y*=b,this},a.prototype.scaleToMagnitude=function(a){var b=a/this.magnitude();return this.x*=b,this.y*=b,this},a.prototype.setValues=function(b,c){return b instanceof a?(this.x=b.x,this.y=b.y):(this.x=b,this.y=c),this},a.prototype.subtract=function(a){return this.x-=a.x,this.y-=a.y,this},a.prototype.toString=function(){return"Vector2D("+this.x+", "+this.y+")"},a.prototype.translate=function(a,b){return b===undefined&&(b=a),this.x+=a,this.y+=b,this},a.tripleProduct=function(a,b,c){var d=a.dotProduct(c),e=b.dotProduct(c);return new Crafty.math.Vector2D(b.x*d-a.x*e,b.y*d-a.y*e)},a}(),Crafty.math.Matrix2D=function(){return Matrix2D=function(a,b,c,d,e,f){if(a instanceof Matrix2D)this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.e=a.e,this.f=a.f;else if(arguments.length===6)this.a=a,this.b=b,this.c=c,this.d=d,this.e=e,this.f=f;else if(arguments.length>0)throw"Unexpected number of arguments for Matrix2D()"},Matrix2D.prototype.a=1,Matrix2D.prototype.b=0,Matrix2D.prototype.c=0,Matrix2D.prototype.d=1,Matrix2D.prototype.e=0,Matrix2D.prototype.f=0,Matrix2D.prototype.apply=function(a){var b=a.x;return a.x=b*this.a+a.y*this.c+this.e,a.y=b*this.b+a.y*this.d+this.f,a},Matrix2D.prototype.clone=function(){return new Matrix2D(this)},Matrix2D.prototype.combine=function(a){var b=this.a;return this.a=b*a.a+this.b*a.c,this.b=b*a.b+this.b*a.d,b=this.c,this.c=b*a.a+this.d*a.c,this.d=b*a.b+this.d*a.d,b=this.e,this.e=b*a.a+this.f*a.c+a.e,this.f=b*a.b+this.f*a.d+a.f,this},Matrix2D.prototype.equals=function(a){return a instanceof Matrix2D&&this.a==a.a&&this.b==a.b&&this.c==a.c&&this.d==a.d&&this.e==a.e&&this.f==a.f},Matrix2D.prototype.determinant=function(){return this.a*this.d-this.b*this.c},Matrix2D.prototype.invert=function(){var a=this.determinant();if(a!==0){var b={a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f};this.a=b.d/a,this.b=-b.b/a,this.c=-b.c/a,this.d=b.a/a,this.e=(b.c*b.f-b.e*b.d)/a,this.f=(b.e*b.b-b.a*b.f)/a}return this},Matrix2D.prototype.isIdentity=function(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.e===0&&this.f===0},Matrix2D.prototype.isInvertible=function(){return this.determinant()!==0},Matrix2D.prototype.preRotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.a;return this.a=b*d-c*this.b,this.b=c*d+b*this.b,d=this.c,this.c=b*d-c*this.d,this.d=c*d+b*this.d,this},Matrix2D.prototype.preScale=function(a,b){return b===undefined&&(b=a),this.a*=a,this.b*=b,this.c*=a,this.d*=b,this},Matrix2D.prototype.preTranslate=function(a,b){return typeof a=="number"?(this.e+=a,this.f+=b):(this.e+=a.x,this.f+=a.y),this},Matrix2D.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.a;return this.a=b*d-c*this.b,this.b=c*d+b*this.b,d=this.c,this.c=b*d-c*this.d,this.d=c*d+b*this.d,d=this.e,this.e=b*d-c*this.f,this.f=c*d+b*this.f,this},Matrix2D.prototype.scale=function(a,b){return b===undefined&&(b=a),this.a*=a,this.b*=b,this.c*=a,this.d*=b,this.e*=a,this.f*=b,this},Matrix2D.prototype.setValues=function(a,b,c,d,e,f){return a instanceof Matrix2D?(this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.e=a.e,this.f=a.f):(this.a=a,this.b=b,this.c=c,this.d=d,this.e=e,this.f=f),this},Matrix2D.prototype.toString=function(){return"Matrix2D(["+this.a+", "+this.c+", "+this.e+"] ["+this.b+", "+this.d+", "+this.f+"] [0, 0, 1])"},Matrix2D.prototype.translate=function(a,b){return typeof a=="number"?(this.e+=this.a*a+this.c*b,this.f+=this.b*a+this.d*b):(this.e+=this.a*a.x+this.c*a.y,this.f+=this.b*a.x+this.d*a.y),this},Matrix2D}(),Crafty.c("Delay",{init:function(){this._delays=[],this.bind("EnterFrame",function(){var a=(new Date).getTime();for(var b in this._delays){var c=this._delays[b];!c.triggered&&c.start+c.delay+c.pause<a&&(c.triggered=!0,c.func.call(this))}}),this.bind("Pause",function(){var a=(new Date).getTime();for(var b in this._delays)this._delays[b].pauseBuffer=a}),this.bind("Unpause",function(){var a=(new Date).getTime();for(var b in this._delays){var c=this._delays[b];c.pause+=a-c.pauseBuffer}})},delay:function(a,b){return this._delays.push({start:(new Date).getTime(),func:a,delay:b,triggered:!1,pauseBuffer:0,pause:0})}})}(Crafty,window,window.document),function(a){function h(a,b){var c=a.length;while(c--)if(a[c]===b)return c;return-1}function i(a){var b,g,i,j,k;b=a.keyCode;if(b==93||b==224)b=91;if(b in d){d[b]=!0;for(i in f)f[i]==b&&(l[i]=!0);return}if(!l.filter.call(this,a))return;if(!(b in c))return;for(j=0;j<c[b].length;j++){g=c[b][j];if(g.scope==e||g.scope=="all"){k=g.mods.length>0;for(i in d)if(!d[i]&&h(g.mods,+i)>-1||d[i]&&h(g.mods,+i)==-1)k=!1;(g.mods.length==0&&!d[16]&&!d[18]&&!d[17]&&!d[91]||k)&&g.method(a,g)===!1&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0))}}}function j(a){var b=a.keyCode,c;if(b==93||b==224)b=91;if(b in d){d[b]=!1;for(c in f)f[c]==b&&(l[c]=!1)}}function k(){for(b in d)d[b]=!1;for(b in f)l[b]=!1}function l(a,b,d){var e,h,i,j;d===undefined&&(d=b,b="all"),a=a.replace(/\s/g,""),e=a.split(","),e[e.length-1]==""&&(e[e.length-2]+=",");for(i=0;i<e.length;i++){h=[],a=e[i].split("+");if(a.length>1){h=a.slice(0,a.length-1);for(j=0;j<h.length;j++)h[j]=f[h[j]];a=[a[a.length-1]]}a=a[0],a=g[a]||a.toUpperCase().charCodeAt(0),a in c||(c[a]=[]),c[a].push({shortcut:e[i],scope:b,method:d,key:e[i],mods:h})}}function m(a){var b=(a.target||a.srcElement).tagName;return b!="INPUT"&&b!="SELECT"&&b!="TEXTAREA"}function n(a){e=a||"all"}function o(){return e||"all"}function p(a){var b,d,e;for(b in c){d=c[b];for(e=0;e<d.length;)d[e].scope===a?d.splice(e,1):e++}}function q(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})}var b,c={},d={16:!1,18:!1,17:!1,91:!1},e="all",f={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},g={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220};for(b=1;b<20;b++)f["f"+b]=111+b;for(b in f)l[b]=!1;q(document,"keydown",i),q(document,"keyup",j),q(window,"focus",k),a.key=l,a.key.setScope=n,a.key.getScope=o,a.key.deleteScope=p,a.key.filter=m,typeof module!="undefined"&&(module.exports=key)}(this),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.unshift,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){if(a instanceof x)return a;if(!(this instanceof x))return new x(a);this._wrapped=a};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.3.3";var y=x.each=x.forEach=function(a,b,d){if(a==null)return;if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return a==null?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)},x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=x.toArray(a).reverse();return d&&!e&&(b=x.bind(b,d)),e?x.reduce(f,b,c,d):x.reduce(f,b)},x.find=x.detect=function(a,b,c){var d;return z(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},x.filter=x.select=function(a,b,c){var d=[];return a==null?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},x.reject=function(a,b,c){var d=[];return a==null?d:(y(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return a==null?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c}),!!e)};var z=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return a==null?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){if(e||(e=b.call(d,a,f,g)))return c}),!!e)};x.include=x.contains=function(a,b){var c=!1;return a==null?c:s&&a.indexOf===s?a.indexOf(b)!=-1:(c=z(a,function(a){return a===b}),c)},x.invoke=function(a,b){var c=h.call(arguments,2);return x.map(a,function(a){return(x.isFunction(b)?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-Infinity;var d={computed:-Infinity};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return Infinity;var d={computed:Infinity};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=Math.floor(Math.random()*++c),d[c-1]=d[b],d[b]=a}),d},x.sortBy=function(a,b,c){var d=A(a,b);return x.pluck(x.map(a,function(a,b,e){return{value:a,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c===void 0?1:d===void 0?-1:c<d?-1:c>d?1:0}),"value")};var A=function(a,b){return x.isFunction(b)?b:function(a){return a[b]}},B=function(a,b,c){var d={},e=A(a,b);return y(a,function(a,b){var f=e(a,b);c(d,f,a)}),d};x.groupBy=function(a,b){return B(a,b,function(a,b,c){(a[b]||(a[b]=[])).push(c)})},x.countBy=function(a,b){return B(a,b,function(a,b,c){a[b]||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c){c||(c=x.identity);var d=c(b),e=0,f=a.length;while(e<f){var g=e+f>>1;c(a[g])<d?e=g+1:f=g}return e},x.toArray=function(a){return a?x.isArray(a)||x.isArguments(a)?h.call(a):x.isFunction(a.toArray)?a.toArray():x.values(a):[]},x.size=function(a){return a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return b!=null&&!c?h.call(a,0,b):a[0]},x.initial=function(a,b,c){return h.call(a,0,a.length-(b==null||c?1:b))},x.last=function(a,b,c){return b!=null&&!c?h.call(a,Math.max(a.length-b,0)):a[a.length-1]},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,b==null||c?1:b)},x.compact=function(a){return x.filter(a,function(a){return!!a})};var C=function(a,b,c){return y(a,function(a){x.isArray(a)?b?g.apply(c,a):C(a,b,c):c.push(a)}),c};x.flatten=function(a,b){return C(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c){var d=c?x.map(a,c):a,e=[];return x.reduce(d,function(c,d,f){if(b?x.last(c)!==d||!c.length:!x.include(c,d))c.push(d),e.push(a[f]);return c},[]),e},x.union=function(){return x.uniq(C(arguments,!0,[]))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=C(h.call(arguments,1),!0,[]);return x.filter(a,function(a){return!x.include(b,a)})},x.zip=function(){var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=x.pluck(a,""+d);return c},x.object=function(a,b){var c={};for(var d=0,e=a.length;d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;if(s&&a.indexOf===s)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b){if(a==null)return-1;if(t&&a.lastIndexOf===t)return a.lastIndexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var D=function(){};x.bind=function(b,c){var d,e;if(b.bind===w&&w)return w.apply(b,h.call(arguments,1));if(!x.isFunction(b))throw new TypeError;return e=h.call(arguments,2),d=function(){if(this instanceof d){D.prototype=b.prototype;var a=new D,f=b.apply(a,e.concat(h.call(arguments)));return Object(f)===f?f:a}return b.apply(c,e.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);return b.length==0&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b){var c,d,e,f,g,h,i=x.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var j=function(){e=null,g&&(h=a.apply(c,d)),i()};return e||(e=setTimeout(j,b)),f?g=!0:(f=!0,h=a.apply(c,d)),i(),h}},x.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}},x.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}},x.wrap=function(a,b){return function(){var c=[a].concat(h.call(arguments,0));return b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){var b=arguments;for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&(b[b.length]=c);return b},x.values=function(a){return x.map(a,x.identity)},x.pairs=function(a){return x.map(a,function(a,b){return[b,a]})},x.invert=function(a){return x.reduce(a,function(a,b,c){return a[b]=c,a},{})},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=x.flatten(h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=x.flatten(h.call(arguments,1));for(var d in a)x.include(c,d)||(b[d]=a[d]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var E=function(a,b,c,d){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);if(a.isEqual&&x.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&x.isFunction(b.isEqual))return b.isEqual(a);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b
.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var f=c.length;while(f--)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if(e=="[object Array]"){g=a.length,h=g==b.length;if(h)while(g--)if(!(h=g in a==g in b&&E(a[g],b[g],c,d)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var i in a)if(x.has(a,i)){g++;if(!(h=x.has(b,i)&&E(a[i],b[i],c,d)))break}if(h){for(i in b)if(x.has(b,i)&&!(g--))break;h=!g}}return c.pop(),d.pop(),h};x.isEqual=function(a,b){return E(a,b,[],[])},x.isEmpty=function(a){if(a==null)return!0;if(x.isArray(a)||x.isString(a))return a.length===0;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!!a&&a.nodeType==1},x.isArray=u||function(a){return j.call(a)=="[object Array]"},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!!a&&!!x.has(a,"callee")}),x.isFinite=function(a){return x.isNumber(a)&&isFinite(a)},x.isNaN=function(a){return a!==a},x.isBoolean=function(a){return a===!0||a===!1||j.call(a)=="[object Boolean]"},x.isNull=function(a){return a===null},x.isUndefined=function(a){return a===void 0},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},x.random=function(a,b){return a+(0|Math.random()*(b-a+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=x.invert(F.escape);var G={escape:new RegExp("["+x.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(F.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return b==null?"":(""+b).replace(G[a],function(b){return F[a][b]})}}),x.result=function(a,b){if(a==null)return null;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=h.call(arguments);return a.unshift(this._wrapped),O.call(this,c.apply(x,a))}})};var H=0;x.uniqueId=function(a){var b=H++;return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/.^/,J={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var K in J)J[J[K]]=K;var L=/\\|'|\r|\n|\t|\u2028|\u2029/g,M=/\\(\\|'|r|n|t|u2028|u2029)/g,N=function(a){return a.replace(M,function(a,b){return J[b]})};x.template=function(a,b,c){c=x.defaults({},c,x.templateSettings);var d="__p+='"+a.replace(L,function(a){return"\\"+J[a]}).replace(c.escape||I,function(a,b){return"'+\n((__t=("+N(b)+"))==null?'':_.escape(__t))+\n'"}).replace(c.interpolate||I,function(a,b){return"'+\n((__t=("+N(b)+"))==null?'':__t)+\n'"}).replace(c.evaluate||I,function(a,b){return"';\n"+N(b)+"\n__p+='"})+"';\n";c.variable||(d="with(obj||{}){\n"+d+"}\n"),d="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+d+"return __p;\n";try{var e=new Function(c.variable||"obj","_",d)}catch(f){throw f.source=d,f}if(b)return e(b,x);var g=function(a){return e.call(this,a,x)};return g.source="function("+(c.variable||"obj")+"){\n"+d+"}",g},x.chain=function(a){return x(a).chain()};var O=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),(a=="shift"||a=="splice")&&c.length===0&&delete c[0],O.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return O.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){Crafty.c("Flicker",{flicker:!0,init:function(){return this.flicker=!0,this.bind("EnterFrame",function(a){this.flicker||(this.alpha=1);if(a.frame%5===0&&this.flicker)return this.alpha===0?this.alpha=1:this.alpha=0})}})}.call(this),function(){Crafty.c("RandomDamage",{init:function(){var a;return a=Crafty.math.randomInt(1,2),a="damages_"+a,this.addComponent("2D","Canvas",a,"SpriteAnimation").animate(a,[[0,0],[0,1],[0,2],[0,3],[0,4]]).animate(a,15,0).bind("AnimationEnd",function(){return this.destroy()})}})}.call(this),function(){Crafty.c("RandomExplosion",{init:function(){var a;return a=Crafty.math.randomInt(1,11),a="explosions_"+a,this.addComponent("2D","Canvas",a,"SpriteAnimation").animate(a,[[0,0],[0,1],[0,2],[0,3],[0,4]]).animate(a,15,0).bind("AnimationEnd",function(){return this.destroy()})}})}.call(this),function(){$(document).ready(function(){return Crafty.init(),Crafty.canvas.init(),Crafty.canvas._canvas.style.zIndex="1",Crafty.scene("Loading")})}.call(this),function(){Crafty.scene("Loading",function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;a=[],g=""+(Math.floor(Math.random()*7)+1)+".jpg",a.push("/assets/backgrounds/baked/"+g),Crafty.background("url(assets/backgrounds/baked/"+g+") black"),Crafty.bind("EnterFrame",function(a){return Crafty.stage.elem.style.backgroundPosition="0px "+a.frame*2+"px"}),l=["Mmrnmhrm","Shofixti","Mycon"],j=["start_screen"],k=[0,8];for(m=0,q=l.length;m<q;m++){i=l[m];for(n=0,r=k.length;n<r;n++){h=k[n];for(o=0,s=j.length;o<s;o++)d=j[o],f=""+d+"_"+h,a.push("/assets/ships/baked/"+i+"/"+f+".png")}}c=[1,2,3,4,5,6,7,8,9,10,11];for(p=0,t=c.length;p<t;p++)e=c[p],a.push("/assets/explosions/"+e+".png");b=[1,2];for(v=0,u=b.length;v<u;v++)e=b[v],a.push("/assets/damages/"+e+".png");return Crafty.load(a,function(){var a,d,e,g,h,i,m,n,o,p,q,r,s,t,u,v;for(r=0,m=c.length;r<m;r++)d=c[r],g={},g["explosions_"+d]=[0,0],Crafty.sprite(128,"/assets/explosions/"+d+".png",g);for(s=0,n=b.length;s<n;s++)d=b[s],g={},g["damages_"+d]=[0,0],Crafty.sprite(128,"/assets/damages/"+d+".png",g);for(t=0,o=l.length;t<o;t++){i=l[t];for(u=0,p=k.length;u<p;u++){h=k[u];for(v=0,q=j.length;v<q;v++)a=j[v],e=new Image,f=""+a+"_"+h,e.src="/assets/ships/baked/"+i+"/"+f+".png",g={},g["ships_"+i+"_"+f]=[0,0],Crafty.sprite(e.width,e.height,e.src,g)}}return $("#loading").hide(),Crafty.scene("StartScreen")},function(a){var b;return b=~~a.percent,$("#loading .bar").html(b).css("width",""+b+"%")},function(a){return console.log("error"),console.log(a)})})}.call(this),function(){var a;a=function(){function a(a,b){this.scope=a,$("#"+this.scope+" .controls .button").hover(function(){return $("#"+this.scope+" .controls .button").removeClass("hover"),$(this).addClass("hover")},function(){return $(this).removeClass("hover")}),$("#"+this.scope+" .controls .button").click(function(){return b($(this).html())}),key.setScope(this.scope),key("enter",this.scope,function(){return b($("#"+this.scope+" .controls .button.hover").html())}),key("down",this.scope,function(){var a;return a=$("#"+this.scope+" .controls .button.hover"),a.removeClass("hover"),a.next(".button").length>0?a.next(".button").addClass("hover"):$("#"+this.scope+" .controls .button").first().addClass("hover")}),key("up",this.scope,function(){var a;return a=$("#"+this.scope+" .controls .button.hover"),a.removeClass("hover"),a.prev(".button").length>0?a.prev(".button").addClass("hover"):$("#"+this.scope+" .controls .button").last().addClass("hover")})}return a.name="Menu",a}(),window.Menu=a}.call(this),function(){Crafty.c("Planet",{init:function(){var a;return a=_.shuffle(["moon","mars","earth"])[0],this.requires("2D, Canvas, planets_"+a).origin("center").attr({y:-this.h,x:Crafty.math.randomInt(this.w,Crafty.viewport.width-this.w),z:0,rotation:Crafty.math.randomInt(0,360)}).bind("EnterFrame",function(){return(this.x>Crafty.viewport.width+this.w||this.x<-this.w||this.y<-this.h||this.y>Crafty.viewport.height+this.h)&&this.destroy(),this.y+=1})}})}.call(this),function(){Crafty.c("Bullet",{init:function(){return this.requires("2D, DOM, Color").attr({h:7,w:3,z:50}).bind("EnterFrame",function(){if(this._x>Crafty.viewport.width||this._x<0||this._y>Crafty.viewport.height||this._y<0)return this.destroy()}),this}}),Crafty.c("PlayerBullet",{setup:function(a){return this.color("#5eb95e"),this.attr({x:a.x+a.w/2-this.w/2,y:a.y-a.h/2+this.h/2,rotation:a.rotation,xspeed:20*Math.sin(a.rotation/(180/Math.PI)),yspeed:20*Math.cos(a.rotation/(180/Math.PI))}),this.bind("EnterFrame",function(){return this.attr({x:this.x+this.xspeed,y:this.y-this.yspeed})}),this}}),Crafty.c("FighterBullet",{dmg:2,init:function(){return this.requires("Bullet").color("red").attr({h:5,w:2}).bind("EnterFrame",function(){return this.attr({x:this.x-this.xspeed,y:this.y+this.yspeed})})}}),Crafty.c("FighterBullets",{init:function(){return this.bullets=[],this.bullets.push(Crafty.e("FighterBullet")),this.bullets.push(Crafty.e("FighterBullet")),this},setup:function(a){var b,c,d,e,f;c=0,f=this.bullets;for(d=0,e=f.length;d<e;d++)b=f[d],b.attr({y:a.y+a.h/2+b.h/2,rotation:a.rotation,xspeed:10*Math.sin(a.rotation/(180/Math.PI)),yspeed:10*Math.cos(a.rotation/(180/Math.PI))}),c===0?b.attr({x:a.x+8}):b.attr({x:a.x+a.w-8}),c++;return this}})}.call(this),function(){Crafty.c("Player",{movementSpeed:11,isLoading:!0,health:100,init:function(){var a;return a=!1,this.update_health(),this.requires("2D, Canvas, ships_Shofixti_start_screen_0, Fourway, Flicker, Keyboard, Collision").attr({x:Crafty.viewport.width/2-this.w/2,y:Crafty.viewport.height-this.h-5,z:50}).fourway(this.movementSpeed).bind("Moved",function(a){return this.screenLimits(a)}).bind("KeyDown",function(b){if(b.keyCode===Crafty.keys.SPACE)return a=!0}).bind("KeyUp",function(b){if(b.keyCode===Crafty.keys.SPACE)return a=!1}).bind("EnterFrame",function(b){return this.isLoading&&this.loadingAnim(),a&&b.frame%10===0&&this.shoot(),this.isPlaying}).bind("Hurt",function(a){return this.health-=a,Crafty.e("RandomDamage").attr({x:this.x-this.w/2,y:this.y-this.h/2,z:100}),this.health<=0&&(this.health=0,this.trigger("Die")),this.update_health()}).bind("Die",function(){return Crafty.e("RandomExplosion").attr({x:this.x-this.w/2,y:this.y-this.h/2,z:50}),this.destroy(),this.gameOver()}).onHit("Enemy",function(a){var b;return b=a[0].obj,this.trigger("Hurt",b.hitDmg),b.trigger("Die")}).onHit("Bullet",function(a){var b;return b=a[0].obj,this.trigger("Hurt",b.dmg),b.destroy()})},loadingAnim:function(){this.y--;if(this.y<Crafty.viewport.height-this.h-Crafty.viewport.height/10)return this.isLoading=!1,this.flicker=!1},screenLimits:function(a){if(this.x+this.w>Crafty.viewport.width||this.x+this.w<this.w||this.y+this.h-10<this.h||this.y+this.h+10>Crafty.viewport.height||this.isLoading)return this.attr({x:a.x,y:a.y})},shoot:function(){return Crafty.e("Bullet","PlayerBullet").setup(this)},update_health:function(){return $("#life .bar").html(this.health).css("width",""+this.health+"%"),this.health<=50&&this.health>20?($("#life .progress").removeClass("progress-danger"),$("#life .progress").removeClass("progress-success"),$("#life .progress").addClass("progress-warning")):this.health<=20?($("#life .progress").removeClass("progress-success"),$("#life .progress").removeClass("progress-warning"),$("#life .progress").addClass("progress-danger")):($("#life .progress").removeClass("progress-danger"),$("#life .progress").removeClass("progress-warning"),$("#life .progress").addClass("progress-success"))},gameOver:function(){return $("#game_over").show(),new Menu("game_over",function(a){if(a==="Restart")return key.deleteScope("game_over"),$("#game_over").hide(),Crafty.scene("Level1")})}})}.call(this),function(){Crafty.c("Fighter",{hitDmg:10,shootingSpeed:30,init:function(){return this.shootingSpeed=this.shootingSpeed+Crafty.math.randomInt(10,30),this.requires("ships_Mmrnmhrm_start_screen_8").attr({x:Crafty.math.randomInt(this.w,Crafty.viewport.width-this.w)}).bind("EnterFrame",function(a){this.y+=4;if(a.frame%this.shootingSpeed===0)return Crafty.e("FighterBullets").setup(this)})}}),Crafty.c("Kamikaze",{hitDmg:25,init:function(){var a,b;return a=!1,b=Crafty(Crafty("Player")[0]),this.requires("ships_Mycon_start_screen_8").attr({x:Crafty.math.randomInt(this.w+Crafty.viewport.width/5,Crafty.viewport.width-Crafty.viewport.width/5)}).bind("EnterFrame",function(c){return this.y<0&&(this.y+=2),this.x<b.x&&!a&&(this.x+=4),this.x>b.x&&!a&&(this.x-=4),this.x===b.x&&(a=!0),a?this.y+=20:this.y+=15})}}),Crafty.c("Enemy",{init:function(){return this.requires("2D,Canvas,Collision").origin("center").attr({y:-this.h-50,z:50}).onHit("PlayerBullet",function(a){var b;return b=a[0].obj,this.trigger("Hurt",1e3),b.destroy()}).bind("Hurt",function(a){return this.trigger("Die")}).bind("Die",function(){return Crafty.e("RandomExplosion").attr({x:this.x-this.w/2,y:this.y-this.h/2,z:50}),this.destroy()}).bind("EnterFrame",function(a){return this.screenLimits()})},screenLimits:function(){if(this.x>Crafty.viewport.width+this.w||this.x<-this.w||this.y<-this.h||this.y>Crafty.viewport.height+this.h)return this.destroy()}})}.call(this),function(){Crafty.c("TopFighterSquadron",{init:function(){var a;return a=Crafty.e("Enemy, Fighter"),a.x+128+a.w>Crafty.viewport.width?Crafty.e("Enemy, Fighter").attr({x:a.x-128}):Crafty.e("Enemy, Fighter").attr({x:a.x+128})}})}.call(this),function(){Crafty.scene("StartScreen",function(){return $("#menu").show(),new Menu("menu",function(a){if(a==="Start")return key.deleteScope("menu"),$("#menu").hide(),Crafty.scene("Level1")})})}.call(this),function(){Crafty.scene("Level1",function(){var a;return $("#game").show(),key.setScope("game"),key("esc, p","game",function(){return Crafty.pause(),$("#pause").toggle()}),a=Crafty.e("Player"),this.do_stuff=function(b){if(a.isLoading)return;b.frame%150===0&&Crafty.e("Enemy, Kamikaze");if(b.frame%100===0)return Crafty.e("TopFighterSquadron")},this.bind("EnterFrame",this.do_stuff)},function(){return this.unbind("EnterFrame",this.do_stuff),key.deleteScope("game")})}.call(this);